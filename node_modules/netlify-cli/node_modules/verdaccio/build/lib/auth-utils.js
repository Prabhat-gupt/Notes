"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.allow_action = allow_action;
exports.createAnonymousRemoteUser = createAnonymousRemoteUser;
exports.createRemoteUser = createRemoteUser;
exports.expireReasons = exports.defaultUserRateLimiting = exports.defaultSecurity = void 0;
exports.getApiToken = getApiToken;
exports.getDefaultPlugins = getDefaultPlugins;
exports.getMiddlewareCredentials = getMiddlewareCredentials;
exports.getSecurity = getSecurity;
exports.handleSpecialUnpublish = handleSpecialUnpublish;
exports.isAESLegacy = isAESLegacy;
exports.isAuthHeaderValid = isAuthHeaderValid;
exports.parseAESCredentials = parseAESCredentials;
exports.parseAuthTokenHeader = parseAuthTokenHeader;
exports.parseBasicPayload = parseBasicPayload;
exports.validatePassword = validatePassword;
exports.verifyJWTPayload = verifyJWTPayload;
var _debug = _interopRequireDefault(require("debug"));
var _lodash = _interopRequireDefault(require("lodash"));
var _utils = require("@verdaccio/utils");
var _logger = require("../lib/logger");
var _constants = require("./constants");
var _cryptoUtils = require("./crypto-utils");
var _utils2 = require("./utils");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const debug = (0, _debug.default)('verdaccio');
function validatePassword(password,
// pragma: allowlist secret
minLength = _constants.DEFAULT_MIN_LIMIT_PASSWORD) {
  return typeof password === 'string' && password.length >= minLength;
}

/**
 * Create a RemoteUser object
 * @return {Object} { name: xx, pluginGroups: [], real_groups: [] }
 */
function createRemoteUser(name, pluginGroups) {
  const isGroupValid = Array.isArray(pluginGroups);
  const groups = Array.from(new Set((isGroupValid ? pluginGroups : []).concat([_constants.ROLES.$ALL, _constants.ROLES.$AUTH, _constants.ROLES.DEPRECATED_ALL, _constants.ROLES.DEPRECATED_AUTH, _constants.ROLES.ALL])));
  return {
    name,
    groups,
    real_groups: pluginGroups
  };
}

/**
 * Builds an anonymous remote user in case none is logged in.
 * @return {Object} { name: xx, groups: [], real_groups: [] }
 */
function createAnonymousRemoteUser() {
  return {
    name: undefined,
    // groups without '$' are going to be deprecated eventually
    groups: [_constants.ROLES.$ALL, _constants.ROLES.$ANONYMOUS, _constants.ROLES.DEPRECATED_ALL, _constants.ROLES.DEPRECATED_ANONYMOUS],
    real_groups: []
  };
}
function allow_action(action) {
  return function (user, pkg, callback) {
    debug('[auth/allow_action]: user: %o', user === null || user === void 0 ? void 0 : user.name);
    const {
      name,
      groups
    } = user;
    const groupAccess = pkg[action];
    const hasPermission = groupAccess.some(group => name === group || groups.includes(group));
    debug('[auth/allow_action]: hasPermission? %o} for user: %o', hasPermission, user === null || user === void 0 ? void 0 : user.name);
    if (hasPermission) {
      _logger.logger.info({
        remote: user.name
      }, `auth/allow_action: access granted to: @{user}`);
      return callback(null, true);
    }
    if (name) {
      callback(_utils2.ErrorCode.getForbidden(`user ${name} is not allowed to ${action} package ${pkg.name}`));
    } else {
      callback(_utils2.ErrorCode.getUnauthorized(`authorization required to ${action} package ${pkg.name}`));
    }
  };
}

/**
 *
 */
function handleSpecialUnpublish() {
  return function (user, pkg, callback) {
    const action = 'unpublish';
    // verify whether the unpublish prop has been defined
    const isUnpublishMissing = _lodash.default.isNil(pkg[action]);
    const hasGroups = isUnpublishMissing ? false : pkg[action].length > 0;
    debug('fallback unpublish for @{name} has groups: %o for %o', hasGroups, user === null || user === void 0 ? void 0 : user.name);
    if (isUnpublishMissing || hasGroups === false) {
      return callback(null, undefined);
    }
    debug('allow_action for %o for %o has groups: %o for %o', action, user === null || user === void 0 ? void 0 : user.name, hasGroups, user);
    return allow_action(action)(user, pkg, callback);
  };
}
function getDefaultPlugins(logger) {
  return {
    authenticate(_user, _password, cb) {
      // pragma: allowlist secret
      cb(_utils2.ErrorCode.getForbidden(_constants.API_ERROR.BAD_USERNAME_PASSWORD));
    },
    add_user(_user, _password, cb) {
      // pragma: allowlist secret
      return cb(_utils2.ErrorCode.getConflict(_constants.API_ERROR.BAD_USERNAME_PASSWORD));
    },
    // FIXME: allow_action and allow_publish should be in the @verdaccio/types
    // @ts-ignore
    allow_access: allow_action('access', logger),
    // @ts-ignore
    allow_publish: allow_action('publish', logger),
    allow_unpublish: handleSpecialUnpublish()
  };
}
const defaultWebTokenOptions = {
  sign: {
    // The expiration token for the website is 1 hour
    expiresIn: _constants.TIME_EXPIRATION_1H
  },
  verify: {}
};
const defaultApiTokenConf = {
  legacy: true
};

// we limit max 1000 request per 15 minutes on user endpoints
const defaultUserRateLimiting = {
  windowMs: 15 * 60 * 1000,
  // 15 minutes
  max: 1000
};
exports.defaultUserRateLimiting = defaultUserRateLimiting;
const defaultSecurity = {
  web: defaultWebTokenOptions,
  api: defaultApiTokenConf
};
exports.defaultSecurity = defaultSecurity;
function getSecurity(config) {
  if (_lodash.default.isNil(config.security) === false) {
    return _lodash.default.merge(defaultSecurity, config.security);
  }
  return defaultSecurity;
}
function isAESLegacy(security) {
  const {
    legacy,
    jwt
  } = security.api;
  return _lodash.default.isNil(legacy) === false && _lodash.default.isNil(jwt) && legacy === true;
}
async function getApiToken(auth, config, remoteUser, aesPassword) {
  const security = getSecurity(config);
  if (isAESLegacy(security)) {
    // fallback all goes to AES encryption
    return await new Promise(resolve => {
      resolve(auth.aesEncrypt((0, _utils.buildUserBuffer)(remoteUser.name, aesPassword)).toString('base64'));
    });
  }
  // i am wiling to use here _.isNil but flow does not like it yet.
  const {
    jwt
  } = security.api;
  if (jwt && jwt.sign) {
    return await auth.jwtEncrypt(remoteUser, jwt.sign);
  }
  return await new Promise(resolve => {
    resolve(auth.aesEncrypt((0, _utils.buildUserBuffer)(remoteUser.name, aesPassword)).toString('base64'));
  });
}
function parseAuthTokenHeader(authorizationHeader) {
  const parts = authorizationHeader.split(' ');
  const [scheme, token] = parts;
  return {
    scheme,
    token
  };
}
function parseBasicPayload(credentials) {
  const index = credentials.indexOf(':');
  if (index < 0) {
    return;
  }
  const user = credentials.slice(0, index);
  const password = credentials.slice(index + 1);
  return {
    user,
    password
  };
}
function parseAESCredentials(authorizationHeader, secret) {
  const {
    scheme,
    token
  } = parseAuthTokenHeader(authorizationHeader);

  // basic is deprecated and should not be enforced
  if (scheme.toUpperCase() === _constants.TOKEN_BASIC.toUpperCase()) {
    const credentials = (0, _utils2.convertPayloadToBase64)(token).toString();
    return credentials;
  } else if (scheme.toUpperCase() === _constants.TOKEN_BEARER.toUpperCase()) {
    const tokenAsBuffer = (0, _utils2.convertPayloadToBase64)(token);
    const credentials = (0, _cryptoUtils.aesDecrypt)(tokenAsBuffer, secret).toString('utf8');
    return credentials;
  }
}
const expireReasons = ['JsonWebTokenError', 'TokenExpiredError'];
exports.expireReasons = expireReasons;
function verifyJWTPayload(token, secret) {
  try {
    const payload = (0, _cryptoUtils.verifyPayload)(token, secret);
    return payload;
  } catch (error) {
    // #168 this check should be removed as soon AES encrypt is removed.
    if (expireReasons.includes(error.name)) {
      // it might be possible the jwt configuration is enabled and
      // old tokens fails still remains in usage, thus
      // we return an anonymous user to force log in.
      return createAnonymousRemoteUser();
    }
    throw _utils2.ErrorCode.getCode(_constants.HTTP_STATUS.UNAUTHORIZED, error.message);
  }
}
function isAuthHeaderValid(authorization) {
  return authorization.split(' ').length === 2;
}
function getMiddlewareCredentials(security, secret, authorizationHeader) {
  if (isAESLegacy(security)) {
    const credentials = parseAESCredentials(authorizationHeader, secret);
    if (!credentials) {
      return;
    }
    const parsedCredentials = parseBasicPayload(credentials);
    if (!parsedCredentials) {
      return;
    }
    return parsedCredentials;
  }
  const {
    scheme,
    token
  } = parseAuthTokenHeader(authorizationHeader);
  if (_lodash.default.isString(token) && scheme.toUpperCase() === _constants.TOKEN_BEARER.toUpperCase()) {
    return verifyJWTPayload(token, secret);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZWJ1ZyIsImJ1aWxkRGVidWciLCJ2YWxpZGF0ZVBhc3N3b3JkIiwicGFzc3dvcmQiLCJtaW5MZW5ndGgiLCJERUZBVUxUX01JTl9MSU1JVF9QQVNTV09SRCIsImxlbmd0aCIsImNyZWF0ZVJlbW90ZVVzZXIiLCJuYW1lIiwicGx1Z2luR3JvdXBzIiwiaXNHcm91cFZhbGlkIiwiQXJyYXkiLCJpc0FycmF5IiwiZ3JvdXBzIiwiZnJvbSIsIlNldCIsImNvbmNhdCIsIlJPTEVTIiwiJEFMTCIsIiRBVVRIIiwiREVQUkVDQVRFRF9BTEwiLCJERVBSRUNBVEVEX0FVVEgiLCJBTEwiLCJyZWFsX2dyb3VwcyIsImNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIiLCJ1bmRlZmluZWQiLCIkQU5PTllNT1VTIiwiREVQUkVDQVRFRF9BTk9OWU1PVVMiLCJhbGxvd19hY3Rpb24iLCJhY3Rpb24iLCJ1c2VyIiwicGtnIiwiY2FsbGJhY2siLCJncm91cEFjY2VzcyIsImhhc1Blcm1pc3Npb24iLCJzb21lIiwiZ3JvdXAiLCJpbmNsdWRlcyIsImxvZ2dlciIsImluZm8iLCJyZW1vdGUiLCJFcnJvckNvZGUiLCJnZXRGb3JiaWRkZW4iLCJnZXRVbmF1dGhvcml6ZWQiLCJoYW5kbGVTcGVjaWFsVW5wdWJsaXNoIiwiaXNVbnB1Ymxpc2hNaXNzaW5nIiwiXyIsImlzTmlsIiwiaGFzR3JvdXBzIiwiZ2V0RGVmYXVsdFBsdWdpbnMiLCJhdXRoZW50aWNhdGUiLCJfdXNlciIsIl9wYXNzd29yZCIsImNiIiwiQVBJX0VSUk9SIiwiQkFEX1VTRVJOQU1FX1BBU1NXT1JEIiwiYWRkX3VzZXIiLCJnZXRDb25mbGljdCIsImFsbG93X2FjY2VzcyIsImFsbG93X3B1Ymxpc2giLCJhbGxvd191bnB1Ymxpc2giLCJkZWZhdWx0V2ViVG9rZW5PcHRpb25zIiwic2lnbiIsImV4cGlyZXNJbiIsIlRJTUVfRVhQSVJBVElPTl8xSCIsInZlcmlmeSIsImRlZmF1bHRBcGlUb2tlbkNvbmYiLCJsZWdhY3kiLCJkZWZhdWx0VXNlclJhdGVMaW1pdGluZyIsIndpbmRvd01zIiwibWF4IiwiZGVmYXVsdFNlY3VyaXR5Iiwid2ViIiwiYXBpIiwiZ2V0U2VjdXJpdHkiLCJjb25maWciLCJzZWN1cml0eSIsIm1lcmdlIiwiaXNBRVNMZWdhY3kiLCJqd3QiLCJnZXRBcGlUb2tlbiIsImF1dGgiLCJyZW1vdGVVc2VyIiwiYWVzUGFzc3dvcmQiLCJQcm9taXNlIiwicmVzb2x2ZSIsImFlc0VuY3J5cHQiLCJidWlsZFVzZXJCdWZmZXIiLCJ0b1N0cmluZyIsImp3dEVuY3J5cHQiLCJwYXJzZUF1dGhUb2tlbkhlYWRlciIsImF1dGhvcml6YXRpb25IZWFkZXIiLCJwYXJ0cyIsInNwbGl0Iiwic2NoZW1lIiwidG9rZW4iLCJwYXJzZUJhc2ljUGF5bG9hZCIsImNyZWRlbnRpYWxzIiwiaW5kZXgiLCJpbmRleE9mIiwic2xpY2UiLCJwYXJzZUFFU0NyZWRlbnRpYWxzIiwic2VjcmV0IiwidG9VcHBlckNhc2UiLCJUT0tFTl9CQVNJQyIsImNvbnZlcnRQYXlsb2FkVG9CYXNlNjQiLCJUT0tFTl9CRUFSRVIiLCJ0b2tlbkFzQnVmZmVyIiwiYWVzRGVjcnlwdCIsImV4cGlyZVJlYXNvbnMiLCJ2ZXJpZnlKV1RQYXlsb2FkIiwicGF5bG9hZCIsInZlcmlmeVBheWxvYWQiLCJlcnJvciIsImdldENvZGUiLCJIVFRQX1NUQVRVUyIsIlVOQVVUSE9SSVpFRCIsIm1lc3NhZ2UiLCJpc0F1dGhIZWFkZXJWYWxpZCIsImF1dGhvcml6YXRpb24iLCJnZXRNaWRkbGV3YXJlQ3JlZGVudGlhbHMiLCJwYXJzZWRDcmVkZW50aWFscyIsImlzU3RyaW5nIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2xpYi9hdXRoLXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBidWlsZERlYnVnIGZyb20gJ2RlYnVnJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7XG4gIEFQSVRva2VuT3B0aW9ucyxcbiAgQ2FsbGJhY2ssXG4gIENvbmZpZyxcbiAgSVBsdWdpbkF1dGgsXG4gIEpXVE9wdGlvbnMsXG4gIFBhY2thZ2UsXG4gIFJlbW90ZVVzZXIsXG4gIFNlY3VyaXR5LFxufSBmcm9tICdAdmVyZGFjY2lvL3R5cGVzJztcbmltcG9ydCB7IGJ1aWxkVXNlckJ1ZmZlciB9IGZyb20gJ0B2ZXJkYWNjaW8vdXRpbHMnO1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi9saWIvbG9nZ2VyJztcbmltcG9ydCB7XG4gIEF1dGhNaWRkbGV3YXJlUGF5bG9hZCxcbiAgQXV0aFRva2VuSGVhZGVyLFxuICBCYXNpY1BheWxvYWQsXG4gIENvb2tpZVNlc3Npb25Ub2tlbixcbiAgSUF1dGhXZWJVSSxcbn0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHtcbiAgQVBJX0VSUk9SLFxuICBERUZBVUxUX01JTl9MSU1JVF9QQVNTV09SRCxcbiAgSFRUUF9TVEFUVVMsXG4gIFJPTEVTLFxuICBUSU1FX0VYUElSQVRJT05fMUgsXG4gIFRPS0VOX0JBU0lDLFxuICBUT0tFTl9CRUFSRVIsXG59IGZyb20gJy4vY29uc3RhbnRzJztcbmltcG9ydCB7IGFlc0RlY3J5cHQsIHZlcmlmeVBheWxvYWQgfSBmcm9tICcuL2NyeXB0by11dGlscyc7XG5pbXBvcnQgeyBFcnJvckNvZGUsIGNvbnZlcnRQYXlsb2FkVG9CYXNlNjQgfSBmcm9tICcuL3V0aWxzJztcblxuY29uc3QgZGVidWcgPSBidWlsZERlYnVnKCd2ZXJkYWNjaW8nKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUGFzc3dvcmQoXG4gIHBhc3N3b3JkOiBzdHJpbmcsIC8vIHByYWdtYTogYWxsb3dsaXN0IHNlY3JldFxuICBtaW5MZW5ndGg6IG51bWJlciA9IERFRkFVTFRfTUlOX0xJTUlUX1BBU1NXT1JEXG4pOiBib29sZWFuIHtcbiAgcmV0dXJuIHR5cGVvZiBwYXNzd29yZCA9PT0gJ3N0cmluZycgJiYgcGFzc3dvcmQubGVuZ3RoID49IG1pbkxlbmd0aDtcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBSZW1vdGVVc2VyIG9iamVjdFxuICogQHJldHVybiB7T2JqZWN0fSB7IG5hbWU6IHh4LCBwbHVnaW5Hcm91cHM6IFtdLCByZWFsX2dyb3VwczogW10gfVxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUmVtb3RlVXNlcihuYW1lOiBzdHJpbmcsIHBsdWdpbkdyb3Vwczogc3RyaW5nW10pOiBSZW1vdGVVc2VyIHtcbiAgY29uc3QgaXNHcm91cFZhbGlkOiBib29sZWFuID0gQXJyYXkuaXNBcnJheShwbHVnaW5Hcm91cHMpO1xuICBjb25zdCBncm91cHMgPSBBcnJheS5mcm9tKFxuICAgIG5ldyBTZXQoXG4gICAgICAoaXNHcm91cFZhbGlkID8gcGx1Z2luR3JvdXBzIDogW10pLmNvbmNhdChbXG4gICAgICAgIFJPTEVTLiRBTEwsXG4gICAgICAgIFJPTEVTLiRBVVRILFxuICAgICAgICBST0xFUy5ERVBSRUNBVEVEX0FMTCxcbiAgICAgICAgUk9MRVMuREVQUkVDQVRFRF9BVVRILFxuICAgICAgICBST0xFUy5BTEwsXG4gICAgICBdKVxuICAgIClcbiAgKTtcblxuICByZXR1cm4ge1xuICAgIG5hbWUsXG4gICAgZ3JvdXBzLFxuICAgIHJlYWxfZ3JvdXBzOiBwbHVnaW5Hcm91cHMsXG4gIH07XG59XG5cbi8qKlxuICogQnVpbGRzIGFuIGFub255bW91cyByZW1vdGUgdXNlciBpbiBjYXNlIG5vbmUgaXMgbG9nZ2VkIGluLlxuICogQHJldHVybiB7T2JqZWN0fSB7IG5hbWU6IHh4LCBncm91cHM6IFtdLCByZWFsX2dyb3VwczogW10gfVxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQW5vbnltb3VzUmVtb3RlVXNlcigpOiBSZW1vdGVVc2VyIHtcbiAgcmV0dXJuIHtcbiAgICBuYW1lOiB1bmRlZmluZWQsXG4gICAgLy8gZ3JvdXBzIHdpdGhvdXQgJyQnIGFyZSBnb2luZyB0byBiZSBkZXByZWNhdGVkIGV2ZW50dWFsbHlcbiAgICBncm91cHM6IFtST0xFUy4kQUxMLCBST0xFUy4kQU5PTllNT1VTLCBST0xFUy5ERVBSRUNBVEVEX0FMTCwgUk9MRVMuREVQUkVDQVRFRF9BTk9OWU1PVVNdLFxuICAgIHJlYWxfZ3JvdXBzOiBbXSxcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFsbG93X2FjdGlvbihhY3Rpb246IHN0cmluZyk6IEZ1bmN0aW9uIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh1c2VyOiBSZW1vdGVVc2VyLCBwa2c6IFBhY2thZ2UsIGNhbGxiYWNrOiBDYWxsYmFjayk6IHZvaWQge1xuICAgIGRlYnVnKCdbYXV0aC9hbGxvd19hY3Rpb25dOiB1c2VyOiAlbycsIHVzZXI/Lm5hbWUpO1xuICAgIGNvbnN0IHsgbmFtZSwgZ3JvdXBzIH0gPSB1c2VyO1xuICAgIGNvbnN0IGdyb3VwQWNjZXNzID0gcGtnW2FjdGlvbl07XG4gICAgY29uc3QgaGFzUGVybWlzc2lvbiA9IGdyb3VwQWNjZXNzLnNvbWUoKGdyb3VwKSA9PiBuYW1lID09PSBncm91cCB8fCBncm91cHMuaW5jbHVkZXMoZ3JvdXApKTtcbiAgICBkZWJ1ZygnW2F1dGgvYWxsb3dfYWN0aW9uXTogaGFzUGVybWlzc2lvbj8gJW99IGZvciB1c2VyOiAlbycsIGhhc1Blcm1pc3Npb24sIHVzZXI/Lm5hbWUpO1xuXG4gICAgaWYgKGhhc1Blcm1pc3Npb24pIHtcbiAgICAgIGxvZ2dlci5pbmZvKHsgcmVtb3RlOiB1c2VyLm5hbWUgfSwgYGF1dGgvYWxsb3dfYWN0aW9uOiBhY2Nlc3MgZ3JhbnRlZCB0bzogQHt1c2VyfWApO1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHRydWUpO1xuICAgIH1cblxuICAgIGlmIChuYW1lKSB7XG4gICAgICBjYWxsYmFjayhcbiAgICAgICAgRXJyb3JDb2RlLmdldEZvcmJpZGRlbihgdXNlciAke25hbWV9IGlzIG5vdCBhbGxvd2VkIHRvICR7YWN0aW9ufSBwYWNrYWdlICR7cGtnLm5hbWV9YClcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNhbGxiYWNrKFxuICAgICAgICBFcnJvckNvZGUuZ2V0VW5hdXRob3JpemVkKGBhdXRob3JpemF0aW9uIHJlcXVpcmVkIHRvICR7YWN0aW9ufSBwYWNrYWdlICR7cGtnLm5hbWV9YClcbiAgICAgICk7XG4gICAgfVxuICB9O1xufVxuXG4vKipcbiAqXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVTcGVjaWFsVW5wdWJsaXNoKCk6IGFueSB7XG4gIHJldHVybiBmdW5jdGlvbiAodXNlcjogUmVtb3RlVXNlciwgcGtnOiBQYWNrYWdlLCBjYWxsYmFjazogQ2FsbGJhY2spOiB2b2lkIHtcbiAgICBjb25zdCBhY3Rpb24gPSAndW5wdWJsaXNoJztcbiAgICAvLyB2ZXJpZnkgd2hldGhlciB0aGUgdW5wdWJsaXNoIHByb3AgaGFzIGJlZW4gZGVmaW5lZFxuICAgIGNvbnN0IGlzVW5wdWJsaXNoTWlzc2luZzogYm9vbGVhbiA9IF8uaXNOaWwocGtnW2FjdGlvbl0pO1xuICAgIGNvbnN0IGhhc0dyb3VwczogYm9vbGVhbiA9IGlzVW5wdWJsaXNoTWlzc2luZyA/IGZhbHNlIDogcGtnW2FjdGlvbl0ubGVuZ3RoID4gMDtcbiAgICBkZWJ1ZygnZmFsbGJhY2sgdW5wdWJsaXNoIGZvciBAe25hbWV9IGhhcyBncm91cHM6ICVvIGZvciAlbycsIGhhc0dyb3VwcywgdXNlcj8ubmFtZSk7XG4gICAgaWYgKGlzVW5wdWJsaXNoTWlzc2luZyB8fCBoYXNHcm91cHMgPT09IGZhbHNlKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgdW5kZWZpbmVkKTtcbiAgICB9XG4gICAgZGVidWcoJ2FsbG93X2FjdGlvbiBmb3IgJW8gZm9yICVvIGhhcyBncm91cHM6ICVvIGZvciAlbycsIGFjdGlvbiwgdXNlcj8ubmFtZSwgaGFzR3JvdXBzLCB1c2VyKTtcbiAgICByZXR1cm4gYWxsb3dfYWN0aW9uKGFjdGlvbikodXNlciwgcGtnLCBjYWxsYmFjayk7XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0UGx1Z2lucyhsb2dnZXI6IGFueSk6IElQbHVnaW5BdXRoPENvbmZpZz4ge1xuICByZXR1cm4ge1xuICAgIGF1dGhlbnRpY2F0ZShfdXNlcjogc3RyaW5nLCBfcGFzc3dvcmQ6IHN0cmluZywgY2I6IENhbGxiYWNrKTogdm9pZCB7XG4gICAgICAvLyBwcmFnbWE6IGFsbG93bGlzdCBzZWNyZXRcbiAgICAgIGNiKEVycm9yQ29kZS5nZXRGb3JiaWRkZW4oQVBJX0VSUk9SLkJBRF9VU0VSTkFNRV9QQVNTV09SRCkpO1xuICAgIH0sXG5cbiAgICBhZGRfdXNlcihfdXNlcjogc3RyaW5nLCBfcGFzc3dvcmQ6IHN0cmluZywgY2I6IENhbGxiYWNrKTogdm9pZCB7XG4gICAgICAvLyBwcmFnbWE6IGFsbG93bGlzdCBzZWNyZXRcbiAgICAgIHJldHVybiBjYihFcnJvckNvZGUuZ2V0Q29uZmxpY3QoQVBJX0VSUk9SLkJBRF9VU0VSTkFNRV9QQVNTV09SRCkpO1xuICAgIH0sXG5cbiAgICAvLyBGSVhNRTogYWxsb3dfYWN0aW9uIGFuZCBhbGxvd19wdWJsaXNoIHNob3VsZCBiZSBpbiB0aGUgQHZlcmRhY2Npby90eXBlc1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBhbGxvd19hY2Nlc3M6IGFsbG93X2FjdGlvbignYWNjZXNzJywgbG9nZ2VyKSxcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgYWxsb3dfcHVibGlzaDogYWxsb3dfYWN0aW9uKCdwdWJsaXNoJywgbG9nZ2VyKSxcbiAgICBhbGxvd191bnB1Ymxpc2g6IGhhbmRsZVNwZWNpYWxVbnB1Ymxpc2goKSxcbiAgfTtcbn1cblxuY29uc3QgZGVmYXVsdFdlYlRva2VuT3B0aW9uczogSldUT3B0aW9ucyA9IHtcbiAgc2lnbjoge1xuICAgIC8vIFRoZSBleHBpcmF0aW9uIHRva2VuIGZvciB0aGUgd2Vic2l0ZSBpcyAxIGhvdXJcbiAgICBleHBpcmVzSW46IFRJTUVfRVhQSVJBVElPTl8xSCxcbiAgfSxcbiAgdmVyaWZ5OiB7fSxcbn07XG5cbmNvbnN0IGRlZmF1bHRBcGlUb2tlbkNvbmY6IEFQSVRva2VuT3B0aW9ucyA9IHtcbiAgbGVnYWN5OiB0cnVlLFxufTtcblxuLy8gd2UgbGltaXQgbWF4IDEwMDAgcmVxdWVzdCBwZXIgMTUgbWludXRlcyBvbiB1c2VyIGVuZHBvaW50c1xuZXhwb3J0IGNvbnN0IGRlZmF1bHRVc2VyUmF0ZUxpbWl0aW5nID0ge1xuICB3aW5kb3dNczogMTUgKiA2MCAqIDEwMDAsIC8vIDE1IG1pbnV0ZXNcbiAgbWF4OiAxMDAwLFxufTtcblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRTZWN1cml0eTogU2VjdXJpdHkgPSB7XG4gIHdlYjogZGVmYXVsdFdlYlRva2VuT3B0aW9ucyxcbiAgYXBpOiBkZWZhdWx0QXBpVG9rZW5Db25mLFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlY3VyaXR5KGNvbmZpZzogQ29uZmlnKTogU2VjdXJpdHkge1xuICBpZiAoXy5pc05pbChjb25maWcuc2VjdXJpdHkpID09PSBmYWxzZSkge1xuICAgIHJldHVybiBfLm1lcmdlKGRlZmF1bHRTZWN1cml0eSwgY29uZmlnLnNlY3VyaXR5KTtcbiAgfVxuXG4gIHJldHVybiBkZWZhdWx0U2VjdXJpdHk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0FFU0xlZ2FjeShzZWN1cml0eTogU2VjdXJpdHkpOiBib29sZWFuIHtcbiAgY29uc3QgeyBsZWdhY3ksIGp3dCB9ID0gc2VjdXJpdHkuYXBpO1xuXG4gIHJldHVybiBfLmlzTmlsKGxlZ2FjeSkgPT09IGZhbHNlICYmIF8uaXNOaWwoand0KSAmJiBsZWdhY3kgPT09IHRydWU7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBcGlUb2tlbihcbiAgYXV0aDogSUF1dGhXZWJVSSxcbiAgY29uZmlnOiBDb25maWcsXG4gIHJlbW90ZVVzZXI6IFJlbW90ZVVzZXIsXG4gIGFlc1Bhc3N3b3JkOiBzdHJpbmdcbik6IFByb21pc2U8c3RyaW5nPiB7XG4gIGNvbnN0IHNlY3VyaXR5OiBTZWN1cml0eSA9IGdldFNlY3VyaXR5KGNvbmZpZyk7XG4gIGlmIChpc0FFU0xlZ2FjeShzZWN1cml0eSkpIHtcbiAgICAvLyBmYWxsYmFjayBhbGwgZ29lcyB0byBBRVMgZW5jcnlwdGlvblxuICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSk6IHZvaWQgPT4ge1xuICAgICAgcmVzb2x2ZShcbiAgICAgICAgYXV0aC5hZXNFbmNyeXB0KGJ1aWxkVXNlckJ1ZmZlcihyZW1vdGVVc2VyLm5hbWUgYXMgc3RyaW5nLCBhZXNQYXNzd29yZCkpLnRvU3RyaW5nKCdiYXNlNjQnKVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuICAvLyBpIGFtIHdpbGluZyB0byB1c2UgaGVyZSBfLmlzTmlsIGJ1dCBmbG93IGRvZXMgbm90IGxpa2UgaXQgeWV0LlxuICBjb25zdCB7IGp3dCB9ID0gc2VjdXJpdHkuYXBpO1xuXG4gIGlmIChqd3QgJiYgand0LnNpZ24pIHtcbiAgICByZXR1cm4gYXdhaXQgYXV0aC5qd3RFbmNyeXB0KHJlbW90ZVVzZXIsIGp3dC5zaWduKTtcbiAgfVxuICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpOiB2b2lkID0+IHtcbiAgICByZXNvbHZlKFxuICAgICAgYXV0aC5hZXNFbmNyeXB0KGJ1aWxkVXNlckJ1ZmZlcihyZW1vdGVVc2VyLm5hbWUgYXMgc3RyaW5nLCBhZXNQYXNzd29yZCkpLnRvU3RyaW5nKCdiYXNlNjQnKVxuICAgICk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VBdXRoVG9rZW5IZWFkZXIoYXV0aG9yaXphdGlvbkhlYWRlcjogc3RyaW5nKTogQXV0aFRva2VuSGVhZGVyIHtcbiAgY29uc3QgcGFydHMgPSBhdXRob3JpemF0aW9uSGVhZGVyLnNwbGl0KCcgJyk7XG4gIGNvbnN0IFtzY2hlbWUsIHRva2VuXSA9IHBhcnRzO1xuXG4gIHJldHVybiB7IHNjaGVtZSwgdG9rZW4gfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQmFzaWNQYXlsb2FkKGNyZWRlbnRpYWxzOiBzdHJpbmcpOiBCYXNpY1BheWxvYWQge1xuICBjb25zdCBpbmRleCA9IGNyZWRlbnRpYWxzLmluZGV4T2YoJzonKTtcbiAgaWYgKGluZGV4IDwgMCkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHVzZXI6IHN0cmluZyA9IGNyZWRlbnRpYWxzLnNsaWNlKDAsIGluZGV4KTtcbiAgY29uc3QgcGFzc3dvcmQ6IHN0cmluZyA9IGNyZWRlbnRpYWxzLnNsaWNlKGluZGV4ICsgMSk7XG5cbiAgcmV0dXJuIHsgdXNlciwgcGFzc3dvcmQgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQUVTQ3JlZGVudGlhbHMoYXV0aG9yaXphdGlvbkhlYWRlcjogc3RyaW5nLCBzZWNyZXQ6IHN0cmluZykge1xuICBjb25zdCB7IHNjaGVtZSwgdG9rZW4gfSA9IHBhcnNlQXV0aFRva2VuSGVhZGVyKGF1dGhvcml6YXRpb25IZWFkZXIpO1xuXG4gIC8vIGJhc2ljIGlzIGRlcHJlY2F0ZWQgYW5kIHNob3VsZCBub3QgYmUgZW5mb3JjZWRcbiAgaWYgKHNjaGVtZS50b1VwcGVyQ2FzZSgpID09PSBUT0tFTl9CQVNJQy50b1VwcGVyQ2FzZSgpKSB7XG4gICAgY29uc3QgY3JlZGVudGlhbHMgPSBjb252ZXJ0UGF5bG9hZFRvQmFzZTY0KHRva2VuKS50b1N0cmluZygpO1xuXG4gICAgcmV0dXJuIGNyZWRlbnRpYWxzO1xuICB9IGVsc2UgaWYgKHNjaGVtZS50b1VwcGVyQ2FzZSgpID09PSBUT0tFTl9CRUFSRVIudG9VcHBlckNhc2UoKSkge1xuICAgIGNvbnN0IHRva2VuQXNCdWZmZXIgPSBjb252ZXJ0UGF5bG9hZFRvQmFzZTY0KHRva2VuKTtcbiAgICBjb25zdCBjcmVkZW50aWFscyA9IGFlc0RlY3J5cHQodG9rZW5Bc0J1ZmZlciwgc2VjcmV0KS50b1N0cmluZygndXRmOCcpO1xuXG4gICAgcmV0dXJuIGNyZWRlbnRpYWxzO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBleHBpcmVSZWFzb25zOiBzdHJpbmdbXSA9IFsnSnNvbldlYlRva2VuRXJyb3InLCAnVG9rZW5FeHBpcmVkRXJyb3InXTtcblxuZXhwb3J0IGZ1bmN0aW9uIHZlcmlmeUpXVFBheWxvYWQodG9rZW46IHN0cmluZywgc2VjcmV0OiBzdHJpbmcpOiBSZW1vdGVVc2VyIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBwYXlsb2FkOiBSZW1vdGVVc2VyID0gdmVyaWZ5UGF5bG9hZCh0b2tlbiwgc2VjcmV0KTtcblxuICAgIHJldHVybiBwYXlsb2FkO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vICMxNjggdGhpcyBjaGVjayBzaG91bGQgYmUgcmVtb3ZlZCBhcyBzb29uIEFFUyBlbmNyeXB0IGlzIHJlbW92ZWQuXG4gICAgaWYgKGV4cGlyZVJlYXNvbnMuaW5jbHVkZXMoZXJyb3IubmFtZSkpIHtcbiAgICAgIC8vIGl0IG1pZ2h0IGJlIHBvc3NpYmxlIHRoZSBqd3QgY29uZmlndXJhdGlvbiBpcyBlbmFibGVkIGFuZFxuICAgICAgLy8gb2xkIHRva2VucyBmYWlscyBzdGlsbCByZW1haW5zIGluIHVzYWdlLCB0aHVzXG4gICAgICAvLyB3ZSByZXR1cm4gYW4gYW5vbnltb3VzIHVzZXIgdG8gZm9yY2UgbG9nIGluLlxuICAgICAgcmV0dXJuIGNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIoKTtcbiAgICB9XG4gICAgdGhyb3cgRXJyb3JDb2RlLmdldENvZGUoSFRUUF9TVEFUVVMuVU5BVVRIT1JJWkVELCBlcnJvci5tZXNzYWdlKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNBdXRoSGVhZGVyVmFsaWQoYXV0aG9yaXphdGlvbjogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiBhdXRob3JpemF0aW9uLnNwbGl0KCcgJykubGVuZ3RoID09PSAyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWlkZGxld2FyZUNyZWRlbnRpYWxzKFxuICBzZWN1cml0eTogU2VjdXJpdHksXG4gIHNlY3JldDogc3RyaW5nLFxuICBhdXRob3JpemF0aW9uSGVhZGVyOiBzdHJpbmdcbik6IEF1dGhNaWRkbGV3YXJlUGF5bG9hZCB7XG4gIGlmIChpc0FFU0xlZ2FjeShzZWN1cml0eSkpIHtcbiAgICBjb25zdCBjcmVkZW50aWFscyA9IHBhcnNlQUVTQ3JlZGVudGlhbHMoYXV0aG9yaXphdGlvbkhlYWRlciwgc2VjcmV0KTtcbiAgICBpZiAoIWNyZWRlbnRpYWxzKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGFyc2VkQ3JlZGVudGlhbHMgPSBwYXJzZUJhc2ljUGF5bG9hZChjcmVkZW50aWFscyk7XG4gICAgaWYgKCFwYXJzZWRDcmVkZW50aWFscykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHJldHVybiBwYXJzZWRDcmVkZW50aWFscztcbiAgfVxuICBjb25zdCB7IHNjaGVtZSwgdG9rZW4gfSA9IHBhcnNlQXV0aFRva2VuSGVhZGVyKGF1dGhvcml6YXRpb25IZWFkZXIpO1xuXG4gIGlmIChfLmlzU3RyaW5nKHRva2VuKSAmJiBzY2hlbWUudG9VcHBlckNhc2UoKSA9PT0gVE9LRU5fQkVBUkVSLnRvVXBwZXJDYXNlKCkpIHtcbiAgICByZXR1cm4gdmVyaWZ5SldUUGF5bG9hZCh0b2tlbiwgc2VjcmV0KTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBWUE7QUFFQTtBQVFBO0FBU0E7QUFDQTtBQUE0RDtBQUU1RCxNQUFNQSxLQUFLLEdBQUcsSUFBQUMsY0FBVSxFQUFDLFdBQVcsQ0FBQztBQUU5QixTQUFTQyxnQkFBZ0IsQ0FDOUJDLFFBQWdCO0FBQUU7QUFDbEJDLFNBQWlCLEdBQUdDLHFDQUEwQixFQUNyQztFQUNULE9BQU8sT0FBT0YsUUFBUSxLQUFLLFFBQVEsSUFBSUEsUUFBUSxDQUFDRyxNQUFNLElBQUlGLFNBQVM7QUFDckU7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDTyxTQUFTRyxnQkFBZ0IsQ0FBQ0MsSUFBWSxFQUFFQyxZQUFzQixFQUFjO0VBQ2pGLE1BQU1DLFlB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