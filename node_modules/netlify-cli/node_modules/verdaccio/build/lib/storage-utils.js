"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.WHITELIST = void 0;
exports.checkPackageLocal = checkPackageLocal;
exports.checkPackageRemote = checkPackageRemote;
exports.cleanUpLinksRef = cleanUpLinksRef;
exports.cleanUpReadme = cleanUpReadme;
exports.convertAbbreviatedManifest = convertAbbreviatedManifest;
exports.generatePackageTemplate = generatePackageTemplate;
exports.generateRevision = generateRevision;
exports.getLatestReadme = getLatestReadme;
exports.hasInstallScript = hasInstallScript;
exports.isPublishablePackage = isPublishablePackage;
exports.mergeUplinkTimeIntoLocal = mergeUplinkTimeIntoLocal;
exports.normalizePackage = normalizePackage;
exports.prepareSearchPackage = prepareSearchPackage;
exports.publishPackage = publishPackage;
var _lodash = _interopRequireDefault(require("lodash"));
var _core = require("@verdaccio/core");
var _utils = require("@verdaccio/utils");
var _constants = require("./constants");
var _search = _interopRequireDefault(require("./search"));
var _utils2 = require("./utils");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function generatePackageTemplate(name) {
  return {
    // standard things
    name,
    versions: {},
    time: {},
    [_constants.USERS]: {},
    [_constants.DIST_TAGS]: {},
    _uplinks: {},
    _distfiles: {},
    _attachments: {},
    _rev: ''
  };
}

/**
 * Normalize package properties, tags, revision id.
 * @param {Object} pkg package reference.
 */
function normalizePackage(pkg) {
  const pkgProperties = ['versions', 'dist-tags', '_distfiles', '_attachments', '_uplinks', 'time'];
  pkgProperties.forEach(key => {
    const pkgProp = pkg[key];
    if (_lodash.default.isNil(pkgProp) || (0, _utils2.isObject)(pkgProp) === false) {
      pkg[key] = {};
    }
  });
  if (_lodash.default.isString(pkg._rev) === false) {
    pkg._rev = _constants.STORAGE.DEFAULT_REVISION;
  }
  if (_lodash.default.isString(pkg._id) === false) {
    pkg._id = pkg.name;
  }

  // normalize dist-tags
  (0, _utils2.normalizeDistTags)(pkg);
  return pkg;
}
function generateRevision(rev) {
  const _rev = rev.split('-');
  return (+_rev[0] || 0) + 1 + '-' + (0, _utils.generateRandomHexString)();
}
function getLatestReadme(pkg) {
  const versions = pkg['versions'] || {};
  const distTags = pkg[_constants.DIST_TAGS] || {};
  // FIXME: here is a bit tricky add the types
  const latestVersion = distTags['latest'] ? versions[distTags['latest']] || {} : {};
  let readme = _lodash.default.trim(pkg.readme || latestVersion.readme || '');
  if (readme) {
    return readme;
  }

  // In case of empty readme - trying to get ANY readme in the following order: 'next','beta','alpha','test','dev','canary'
  const readmeDistTagsPriority = ['next', 'beta', 'alpha', 'test', 'dev', 'canary'];
  readmeDistTagsPriority.map(function (tag) {
    if (readme) {
      return readme;
    }
    const version = distTags[tag] ? versions[distTags[tag]] || {} : {};
    readme = _lodash.default.trim(version.readme || readme);
  });
  return readme;
}
function cleanUpReadme(version) {
  if (_lodash.default.isNil(version) === false) {
    // @ts-ignore
    delete version.readme;
  }
  return version;
}
const WHITELIST = ['_rev', 'name', 'versions', 'dist-tags', 'readme', 'time', '_id', 'users'];
exports.WHITELIST = WHITELIST;
function cleanUpLinksRef(keepUpLinkData, result) {
  const propertyToKeep = [...WHITELIST];
  if (keepUpLinkData === true) {
    propertyToKeep.push('_uplinks');
  }
  for (const i in result) {
    if (propertyToKeep.indexOf(i) === -1) {
      // Remove sections like '_uplinks' from response
      delete result[i];
    }
  }
  return result;
}

/**
 * Check whether a package it is already a local package
 * @param {*} name
 * @param {*} localStorage
 */
function checkPackageLocal(name, localStorage) {
  return new Promise((resolve, reject) => {
    localStorage.getPackageMetadata(name, (err, results) => {
      if (!_lodash.default.isNil(err) && err.status !== _constants.HTTP_STATUS.NOT_FOUND) {
        return reject(err);
      }
      if (results) {
        return reject(_utils2.ErrorCode.getConflict(_constants.API_ERROR.PACKAGE_EXIST));
      }
      return resolve();
    });
  });
}
function publishPackage(name, metadata, localStorage) {
  return new Promise((resolve, reject) => {
    localStorage.addPackage(name, metadata, (err, latest) => {
      if (!_lodash.default.isNull(err)) {
        return reject(err);
      } else if (!_lodash.default.isUndefined(latest)) {
        _search.default.add(latest);
      }
      return resolve();
    });
  });
}
function checkPackageRemote(name, isAllowPublishOffline, syncMetadata) {
  return new Promise((resolve, reject) => {
    syncMetadata(name, null, {}, (err, packageJsonLocal, upLinksErrors) => {
      // something weird
      if (err && err.status !== _constants.HTTP_STATUS.NOT_FOUND) {
        return reject(err);
      }

      // checking package exist already
      if (_lodash.default.isNil(packageJsonLocal) === false) {
        return reject(_utils2.ErrorCode.getConflict(_constants.API_ERROR.PACKAGE_EXIST));
      }
      for (let errorItem = 0; errorItem < upLinksErrors.length; errorItem++) {
        // checking error
        // if uplink fails with a status other than 404, we report failure
        if (_lodash.default.isNil(upLinksErrors[errorItem][0]) === false) {
          if (upLinksErrors[errorItem][0].status !== _constants.HTTP_STATUS.NOT_FOUND) {
            if (isAllowPublishOffline) {
              return resolve();
            }
            return reject(_utils2.ErrorCode.getServiceUnavailable(_constants.API_ERROR.UPLINK_OFFLINE_PUBLISH));
          }
        }
      }
      return resolve();
    });
  });
}

// tested on v6
function mergeUplinkTimeIntoLocal(cacheManifest, remoteManifest) {
  if ('time' in remoteManifest) {
    // remote override cache time conflicts
    return _objectSpread(_objectSpread({}, cacheManifest), {}, {
      time: _objectSpread(_objectSpread({}, cacheManifest.time), remoteManifest.time)
    });
  }
  return cacheManifest;
}
function prepareSearchPackage(data, time) {
  const latest = _core.pkgUtils.getLatest(data);
  if (latest && data.versions[latest]) {
    const version = data.versions[latest];
    const versions = {
      [latest]: 'latest'
    };
    const pkg = {
      name: version.name,
      description: version.description,
      [_constants.DIST_TAGS]: {
        latest
      },
      maintainers: version.maintainers || [version.author].filter(Boolean),
      author: version.author,
      repository: version.repository,
      readmeFilename: version.readmeFilename || '',
      homepage: version.homepage,
      keywords: version.keywords,
      time: {
        modified: time
      },
      bugs: version.bugs,
      license: version.license,
      versions
    };
    return pkg;
  }
}

/**
 * Check whether the package metadta has enough data to be published
 * @param pkg metadata
 */
function isPublishablePackage(pkg) {
  const keys = Object.keys(pkg);
  return keys.includes('versions');
}
function hasInstallScript(version) {
  if (version !== null && version !== void 0 && version.scripts) {
    const scripts = Object.keys(version.scripts);
    return scripts.find(item => {
      return ['install', 'preinstall', 'postinstall'].includes(item);
    }) !== undefined;
  }
  return false;
}
function convertAbbreviatedManifest(manifest) {
  var _manifest$time;
  const abbreviatedVersions = Object.keys(manifest.versions).reduce((acc, version) => {
    const _version = manifest.versions[version];
    // This should be align with this document
    // https://github.com/npm/registry/blob/master/docs/responses/package-metadata.md#abbreviated-version-object
    const _version_abbreviated = {
      name: _version.name,
      version: _version.version,
      description: _version.description,
      deprecated: _version.deprecated,
      bin: _version.bin,
      dist: _version.dist,
      engines: _version.engines,
      cpu: _version.cpu,
      os: _version.os,
      funding: _version.funding,
      directories: _version.directories,
      dependencies: _version.dependencies,
      devDependencies: _version.devDependencies,
      peerDependencies: _version.peerDependencies,
      peerDependenciesMeta: _version.peerDependenciesMeta,
      optionalDependencies: _version.optionalDependencies,
      bundleDependencies: _version.bundleDependencies,
      // npm cli specifics
      _hasShrinkwrap: _version._hasShrinkwrap,
      hasInstallScript: hasInstallScript(_version)
    };
    acc[version] = _version_abbreviated;
    return acc;
  }, {});
  const convertedManifest = {
    name: manifest['name'],
    [_constants.DIST_TAGS]: manifest[_constants.DIST_TAGS],
    versions: abbreviatedVersions,
    // @ts-ignore
    modified: manifest === null || manifest === void 0 ? void 0 : (_manifest$time = manifest.time) === null || _manifest$time === void 0 ? void 0 : _manifest$time.modified,
    // NOTE: special case for pnpm https://github.com/pnpm/rfcs/pull/2
    time: manifest === null || manifest === void 0 ? void 0 : manifest.time
  };

  // @ts-ignore
  return convertedManifest;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJnZW5lcmF0ZVBhY2thZ2VUZW1wbGF0ZSIsIm5hbWUiLCJ2ZXJzaW9ucyIsInRpbWUiLCJVU0VSUyIsIkRJU1RfVEFHUyIsIl91cGxpbmtzIiwiX2Rpc3RmaWxlcyIsIl9hdHRhY2htZW50cyIsIl9yZXYiLCJub3JtYWxpemVQYWNrYWdlIiwicGtnIiwicGtnUHJvcGVydGllcyIsImZvckVhY2giLCJrZXkiLCJwa2dQcm9wIiwiXyIsImlzTmlsIiwiaXNPYmplY3QiLCJpc1N0cmluZyIsIlNUT1JBR0UiLCJERUZBVUxUX1JFVklTSU9OIiwiX2lkIiwibm9ybWFsaXplRGlzdFRhZ3MiLCJnZW5lcmF0ZVJldmlzaW9uIiwicmV2Iiwic3BsaXQiLCJnZW5lcmF0ZVJhbmRvbUhleFN0cmluZyIsImdldExhdGVzdFJlYWRtZSIsImRpc3RUYWdzIiwibGF0ZXN0VmVyc2lvbiIsInJlYWRtZSIsInRyaW0iLCJyZWFkbWVEaXN0VGFnc1ByaW9yaXR5IiwibWFwIiwidGFnIiwidmVyc2lvbiIsImNsZWFuVXBSZWFkbWUiLCJXSElURUxJU1QiLCJjbGVhblVwTGlua3NSZWYiLCJrZWVwVXBMaW5rRGF0YSIsInJlc3VsdCIsInByb3BlcnR5VG9LZWVwIiwicHVzaCIsImkiLCJpbmRleE9mIiwiY2hlY2tQYWNrYWdlTG9jYWwiLCJsb2NhbFN0b3JhZ2UiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImdldFBhY2thZ2VNZXRhZGF0YSIsImVyciIsInJlc3VsdHMiLCJzdGF0dXMiLCJIVFRQX1NUQVRVUyIsIk5PVF9GT1VORCIsIkVycm9yQ29kZSIsImdldENvbmZsaWN0IiwiQVBJX0VSUk9SIiwiUEFDS0FHRV9FWElTVCIsInB1Ymxpc2hQYWNrYWdlIiwibWV0YWRhdGEiLCJhZGRQYWNrYWdlIiwibGF0ZXN0IiwiaXNOdWxsIiwiaXNVbmRlZmluZWQiLCJTZWFyY2giLCJhZGQiLCJjaGVja1BhY2thZ2VSZW1vdGUiLCJpc0FsbG93UHVibGlzaE9mZmxpbmUiLCJzeW5jTWV0YWRhdGEiLCJwYWNrYWdlSnNvbkxvY2FsIiwidXBMaW5rc0Vycm9ycyIsImVycm9ySXRlbSIsImxlbmd0aCIsImdldFNlcnZpY2VVbmF2YWlsYWJsZSIsIlVQTElOS19PRkZMSU5FX1BVQkxJU0giLCJtZXJnZVVwbGlua1RpbWVJbnRvTG9jYWwiLCJjYWNoZU1hbmlmZXN0IiwicmVtb3RlTWFuaWZlc3QiLCJwcmVwYXJlU2VhcmNoUGFja2FnZSIsImRhdGEiLCJwa2dVdGlscyIsImdldExhdGVzdCIsImRlc2NyaXB0aW9uIiwibWFpbnRhaW5lcnMiLCJhdXRob3IiLCJmaWx0ZXIiLCJCb29sZWFuIiwicmVwb3NpdG9yeSIsInJlYWRtZUZpbGVuYW1lIiwiaG9tZXBhZ2UiLCJrZXl3b3JkcyIsIm1vZGlmaWVkIiwiYnVncyIsImxpY2Vuc2UiLCJpc1B1Ymxpc2hhYmxlUGFja2FnZSIsImtleXMiLCJPYmplY3QiLCJpbmNsdWRlcyIsImhhc0luc3RhbGxTY3JpcHQiLCJzY3JpcHRzIiwiZmluZCIsIml0ZW0iLCJ1bmRlZmluZWQiLCJjb252ZXJ0QWJicmV2aWF0ZWRNYW5pZmVzdCIsIm1hbmlmZXN0IiwiYWJicmV2aWF0ZWRWZXJzaW9ucyIsInJlZHVjZSIsImFjYyIsIl92ZXJzaW9uIiwiX3ZlcnNpb25fYWJicmV2aWF0ZWQiLCJkZXByZWNhdGVkIiwiYmluIiwiZGlzdCIsImVuZ2luZXMiLCJjcHUiLCJvcyIsImZ1bmRpbmciLCJkaXJlY3RvcmllcyIsImRlcGVuZGVuY2llcyIsImRldkRlcGVuZGVuY2llcyIsInBlZXJEZXBlbmRlbmNpZXMiLCJwZWVyRGVwZW5kZW5jaWVzTWV0YSIsIm9wdGlvbmFsRGVwZW5kZW5jaWVzIiwiYnVuZGxlRGVwZW5kZW5jaWVzIiwiX2hhc1Nocmlua3dyYXAiLCJjb252ZXJ0ZWRNYW5pZmVzdCJdLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvc3RvcmFnZS11dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuXG5pbXBvcnQgeyBwa2dVdGlscyB9IGZyb20gJ0B2ZXJkYWNjaW8vY29yZSc7XG5pbXBvcnQge1xuICBBYmJyZXZpYXRlZE1hbmlmZXN0LFxuICBBYmJyZXZpYXRlZFZlcnNpb25zLFxuICBNYW5pZmVzdCxcbiAgUGFja2FnZSxcbiAgVmVyc2lvbixcbn0gZnJvbSAnQHZlcmRhY2Npby90eXBlcyc7XG5pbXBvcnQgeyBnZW5lcmF0ZVJhbmRvbUhleFN0cmluZyB9IGZyb20gJ0B2ZXJkYWNjaW8vdXRpbHMnO1xuXG5pbXBvcnQgeyBJU3RvcmFnZSB9IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7IEFQSV9FUlJPUiwgRElTVF9UQUdTLCBIVFRQX1NUQVRVUywgU1RPUkFHRSwgVVNFUlMgfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgU2VhcmNoIGZyb20gJy4vc2VhcmNoJztcbmltcG9ydCB7IEVycm9yQ29kZSwgaXNPYmplY3QsIG5vcm1hbGl6ZURpc3RUYWdzLCBzZW12ZXJTb3J0IH0gZnJvbSAnLi91dGlscyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVBhY2thZ2VUZW1wbGF0ZShuYW1lOiBzdHJpbmcpOiBQYWNrYWdlIHtcbiAgcmV0dXJuIHtcbiAgICAvLyBzdGFuZGFyZCB0aGluZ3NcbiAgICBuYW1lLFxuICAgIHZlcnNpb25zOiB7fSxcbiAgICB0aW1lOiB7fSxcbiAgICBbVVNFUlNdOiB7fSxcbiAgICBbRElTVF9UQUdTXToge30sXG4gICAgX3VwbGlua3M6IHt9LFxuICAgIF9kaXN0ZmlsZXM6IHt9LFxuICAgIF9hdHRhY2htZW50czoge30sXG4gICAgX3JldjogJycsXG4gIH07XG59XG5cbi8qKlxuICogTm9ybWFsaXplIHBhY2thZ2UgcHJvcGVydGllcywgdGFncywgcmV2aXNpb24gaWQuXG4gKiBAcGFyYW0ge09iamVjdH0gcGtnIHBhY2thZ2UgcmVmZXJlbmNlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplUGFja2FnZShwa2c6IFBhY2thZ2UpOiBQYWNrYWdlIHtcbiAgY29uc3QgcGtnUHJvcGVydGllcyA9IFsndmVyc2lvbnMnLCAnZGlzdC10YWdzJywgJ19kaXN0ZmlsZXMnLCAnX2F0dGFjaG1lbnRzJywgJ191cGxpbmtzJywgJ3RpbWUnXTtcblxuICBwa2dQcm9wZXJ0aWVzLmZvckVhY2goKGtleSk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IHBrZ1Byb3AgPSBwa2dba2V5XTtcblxuICAgIGlmIChfLmlzTmlsKHBrZ1Byb3ApIHx8IGlzT2JqZWN0KHBrZ1Byb3ApID09PSBmYWxzZSkge1xuICAgICAgcGtnW2tleV0gPSB7fTtcbiAgICB9XG4gIH0pO1xuXG4gIGlmIChfLmlzU3RyaW5nKHBrZy5fcmV2KSA9PT0gZmFsc2UpIHtcbiAgICBwa2cuX3JldiA9IFNUT1JBR0UuREVGQVVMVF9SRVZJU0lPTjtcbiAgfVxuXG4gIGlmIChfLmlzU3RyaW5nKHBrZy5faWQpID09PSBmYWxzZSkge1xuICAgIHBrZy5faWQgPSBwa2cubmFtZTtcbiAgfVxuXG4gIC8vIG5vcm1hbGl6ZSBkaXN0LXRhZ3NcbiAgbm9ybWFsaXplRGlzdFRhZ3MocGtnKTtcblxuICByZXR1cm4gcGtnO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVSZXZpc2lvbihyZXY6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IF9yZXYgPSByZXYuc3BsaXQoJy0nKTtcblxuICByZXR1cm4gKCtfcmV2WzBdIHx8IDApICsgMSArICctJyArIGdlbmVyYXRlUmFuZG9tSGV4U3RyaW5nKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRMYXRlc3RSZWFkbWUocGtnOiBQYWNrYWdlKTogc3RyaW5nIHtcbiAgY29uc3QgdmVyc2lvbnMgPSBwa2dbJ3ZlcnNpb25zJ10gfHwge307XG4gIGNvbnN0IGRpc3RUYWdzID0gcGtnW0RJU1RfVEFHU10gfHwge307XG4gIC8vIEZJWE1FOiBoZXJlIGlzIGEgYml0IHRyaWNreSBhZGQgdGhlIHR5cGVzXG4gIGNvbnN0IGxhdGVzdFZlcnNpb246IFZlcnNpb24gfCBhbnkgPSBkaXN0VGFnc1snbGF0ZXN0J10gPyB2ZXJzaW9uc1tkaXN0VGFnc1snbGF0ZXN0J11dIHx8IHt9IDoge307XG4gIGxldCByZWFkbWUgPSBfLnRyaW0ocGtnLnJlYWRtZSB8fCBsYXRlc3RWZXJzaW9uLnJlYWRtZSB8fCAnJyk7XG4gIGlmIChyZWFkbWUpIHtcbiAgICByZXR1cm4gcmVhZG1lO1xuICB9XG5cbiAgLy8gSW4gY2FzZSBvZiBlbXB0eSByZWFkbWUgLSB0cnlpbmcgdG8gZ2V0IEFOWSByZWFkbWUgaW4gdGhlIGZvbGxvd2luZyBvcmRlcjogJ25leHQnLCdiZXRhJywnYWxwaGEnLCd0ZXN0JywnZGV2JywnY2FuYXJ5J1xuICBjb25zdCByZWFkbWVEaXN0VGFnc1ByaW9yaXR5ID0gWyduZXh0JywgJ2JldGEnLCAnYWxwaGEnLCAndGVzdCcsICdkZXYnLCAnY2FuYXJ5J107XG4gIHJlYWRtZURpc3RUYWdzUHJpb3JpdHkubWFwKGZ1bmN0aW9uICh0YWcpOiBzdHJpbmcgfCB2b2lkIHtcbiAgICBpZiAocmVhZG1lKSB7XG4gICAgICByZXR1cm4gcmVhZG1lO1xuICAgIH1cbiAgICBjb25zdCB2ZXJzaW9uOiBWZXJzaW9uIHwgYW55ID0gZGlzdFRhZ3NbdGFnXSA/IHZlcnNpb25zW2Rpc3RUYWdzW3RhZ11dIHx8IHt9IDoge307XG4gICAgcmVhZG1lID0gXy50cmltKHZlcnNpb24ucmVhZG1lIHx8IHJlYWRtZSk7XG4gIH0pO1xuICByZXR1cm4gcmVhZG1lO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYW5VcFJlYWRtZSh2ZXJzaW9uOiBWZXJzaW9uKTogVmVyc2lvbiB7XG4gIGlmIChfLmlzTmlsKHZlcnNpb24pID09PSBmYWxzZSkge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBkZWxldGUgdmVyc2lvbi5yZWFkbWU7XG4gIH1cblxuICByZXR1cm4gdmVyc2lvbjtcbn1cblxuZXhwb3J0IGNvbnN0IFdISVRFTElTVCA9IFtcbiAgJ19yZXYnLFxuICAnbmFtZScsXG4gICd2ZXJzaW9ucycsXG4gICdkaXN0LXRhZ3MnLFxuICAncmVhZG1lJyxcbiAgJ3RpbWUnLFxuICAnX2lkJyxcbiAgJ3VzZXJzJyxcbl07XG5cbmV4cG9ydCBmdW5jdGlvbiBjbGVhblVwTGlua3NSZWYoa2VlcFVwTGlua0RhdGE6IGJvb2xlYW4sIHJlc3VsdDogUGFja2FnZSk6IFBhY2thZ2Uge1xuICBjb25zdCBwcm9wZXJ0eVRvS2VlcCA9IFsuLi5XSElURUxJU1RdO1xuICBpZiAoa2VlcFVwTGlua0RhdGEgPT09IHRydWUpIHtcbiAgICBwcm9wZXJ0eVRvS2VlcC5wdXNoKCdfdXBsaW5rcycpO1xuICB9XG5cbiAgZm9yIChjb25zdCBpIGluIHJlc3VsdCkge1xuICAgIGlmIChwcm9wZXJ0eVRvS2VlcC5pbmRleE9mKGkpID09PSAtMSkge1xuICAgICAgLy8gUmVtb3ZlIHNlY3Rpb25zIGxpa2UgJ191cGxpbmtzJyBmcm9tIHJlc3BvbnNlXG4gICAgICBkZWxldGUgcmVzdWx0W2ldO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8qKlxuICogQ2hlY2sgd2hldGhlciBhIHBhY2thZ2UgaXQgaXMgYWxyZWFkeSBhIGxvY2FsIHBhY2thZ2VcbiAqIEBwYXJhbSB7Kn0gbmFtZVxuICogQHBhcmFtIHsqfSBsb2NhbFN0b3JhZ2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrUGFja2FnZUxvY2FsKG5hbWU6IHN0cmluZywgbG9jYWxTdG9yYWdlOiBJU3RvcmFnZSk6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk6IHZvaWQgPT4ge1xuICAgIGxvY2FsU3RvcmFnZS5nZXRQYWNrYWdlTWV0YWRhdGEobmFtZSwgKGVyciwgcmVzdWx0cyk6IHZvaWQgPT4ge1xuICAgICAgaWYgKCFfLmlzTmlsKGVycikgJiYgZXJyLnN0YXR1cyAhPT0gSFRUUF9TVEFUVVMuTk9UX0ZPVU5EKSB7XG4gICAgICAgIHJldHVybiByZWplY3QoZXJyKTtcbiAgICAgIH1cbiAgICAgIGlmIChyZXN1bHRzKSB7XG4gICAgICAgIHJldHVybiByZWplY3QoRXJyb3JDb2RlLmdldENvbmZsaWN0KEFQSV9FUlJPUi5QQUNLQUdFX0VYSVNUKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHB1Ymxpc2hQYWNrYWdlKG5hbWU6IHN0cmluZywgbWV0YWRhdGE6IGFueSwgbG9jYWxTdG9yYWdlOiBJU3RvcmFnZSk6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCk6IHZvaWQgPT4ge1xuICAgIGxvY2FsU3RvcmFnZS5hZGRQYWNrYWdlKG5hbWUsIG1ldGFkYXRhLCAoZXJyLCBsYXRlc3QpOiB2b2lkID0+IHtcbiAgICAgIGlmICghXy5pc051bGwoZXJyKSkge1xuICAgICAgICByZXR1cm4gcmVqZWN0KGVycik7XG4gICAgICB9IGVsc2UgaWYgKCFfLmlzVW5kZWZpbmVkKGxhdGVzdCkpIHtcbiAgICAgICAgU2VhcmNoLmFkZChsYXRlc3QpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjaGVja1BhY2thZ2VSZW1vdGUoXG4gIG5hbWU6IHN0cmluZyxcbiAgaXNBbGxvd1B1Ymxpc2hPZmZsaW5lOiBib29sZWFuLFxuICBzeW5jTWV0YWRhdGE6IEZ1bmN0aW9uXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpOiB2b2lkID0+IHtcbiAgICBzeW5jTWV0YWRhdGEobmFtZSwgbnVsbCwge30sIChlcnIsIHBhY2thZ2VKc29uTG9jYWwsIHVwTGlua3NFcnJvcnMpOiB2b2lkID0+IHtcbiAgICAgIC8vIHNvbWV0aGluZyB3ZWlyZFxuICAgICAgaWYgKGVyciAmJiBlcnIuc3RhdHVzICE9PSBIVFRQX1NUQVRVUy5OT1RfRk9VTkQpIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChlcnIpO1xuICAgICAgfVxuXG4gICAgICAvLyBjaGVja2luZyBwYWNrYWdlIGV4aXN0IGFscmVhZHlcbiAgICAgIGlmIChfLmlzTmlsKHBhY2thZ2VKc29uTG9jYWwpID09PSBmYWxzZSkge1xuICAgICAgICByZXR1cm4gcmVqZWN0KEVycm9yQ29kZS5nZXRDb25mbGljdChBUElfRVJST1IuUEFDS0FHRV9FWElTVCkpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCBlcnJvckl0ZW0gPSAwOyBlcnJvckl0ZW0gPCB1cExpbmtzRXJyb3JzLmxlbmd0aDsgZXJyb3JJdGVtKyspIHtcbiAgICAgICAgLy8gY2hlY2tpbmcgZXJyb3JcbiAgICAgICAgLy8gaWYgdXBsaW5rIGZhaWxzIHdpdGggYSBzdGF0dXMgb3RoZXIgdGhhbiA0MDQsIHdlIHJlcG9ydCBmYWlsdXJlXG4gICAgICAgIGlmIChfLmlzTmlsKHVwTGlua3NFcnJvcnNbZXJyb3JJdGVtXVswXSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgaWYgKHVwTGlua3NFcnJvcnNbZXJyb3JJdGVtXVswXS5zdGF0dXMgIT09IEhUVFBfU1RBVFVTLk5PVF9GT1VORCkge1xuICAgICAgICAgICAgaWYgKGlzQWxsb3dQdWJsaXNoT2ZmbGluZSkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KEVycm9yQ29kZS5nZXRTZXJ2aWNlVW5hdmFpbGFibGUoQVBJX0VSUk9SLlVQTElOS19PRkZMSU5FX1BVQkxJU0gpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbi8vIHRlc3RlZCBvbiB2NlxuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlVXBsaW5rVGltZUludG9Mb2NhbChjYWNoZU1hbmlmZXN0OiBNYW5pZmVzdCwgcmVtb3RlTWFuaWZlc3Q6IE1hbmlmZXN0KTogYW55IHtcbiAgaWYgKCd0aW1lJyBpbiByZW1vdGVNYW5pZmVzdCkge1xuICAgIC8vIHJlbW90ZSBvdmVycmlkZSBjYWNoZSB0aW1lIGNvbmZsaWN0c1xuICAgIHJldHVybiB7IC4uLmNhY2hlTWFuaWZlc3QsIHRpbWU6IHsgLi4uY2FjaGVNYW5pZmVzdC50aW1lLCAuLi5yZW1vdGVNYW5pZmVzdC50aW1lIH0gfTtcbiAgfVxuXG4gIHJldHVybiBjYWNoZU1hbmlmZXN0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJlcGFyZVNlYXJjaFBhY2thZ2UoZGF0YTogTWFuaWZlc3QsIHRpbWU6IHVua25vd24pOiBhbnkge1xuICBjb25zdCBsYXRlc3QgPSBwa2dVdGlscy5nZXRMYXRlc3QoZGF0YSk7XG5cbiAgaWYgKGxhdGVzdCAmJiBkYXRhLnZlcnNpb25zW2xhdGVzdF0pIHtcbiAgICBjb25zdCB2ZXJzaW9uOiBWZXJzaW9uID0gZGF0YS52ZXJzaW9uc1tsYXRlc3RdO1xuICAgIGNvbnN0IHZlcnNpb25zOiBhbnkgPSB7IFtsYXRlc3RdOiAnbGF0ZXN0JyB9O1xuICAgIGNvbnN0IHBrZzogYW55ID0ge1xuICAgICAgbmFtZTogdmVyc2lvbi5uYW1lLFxuICAgICAgZGVzY3JpcHRpb246IHZlcnNpb24uZGVzY3JpcHRpb24sXG4gICAgICBbRElTVF9UQUdTXTogeyBsYXRlc3QgfSxcbiAgICAgIG1haW50YWluZXJzOiB2ZXJzaW9uLm1haW50YWluZXJzIHx8IFt2ZXJzaW9uLmF1dGhvcl0uZmlsdGVyKEJvb2xlYW4pLFxuICAgICAgYXV0aG9yOiB2ZXJzaW9uLmF1dGhvcixcbiAgICAgIHJlcG9zaXRvcnk6IHZlcnNpb24ucmVwb3NpdG9yeSxcbiAgICAgIHJlYWRtZUZpbGVuYW1lOiB2ZXJzaW9uLnJlYWRtZUZpbGVuYW1lIHx8ICcnLFxuICAgICAgaG9tZXBhZ2U6IHZlcnNpb24uaG9tZXBhZ2UsXG4gICAgICBrZXl3b3JkczogdmVyc2lvbi5rZXl3b3JkcyxcbiAgICAgIHRpbWU6IHtcbiAgICAgICAgbW9kaWZpZWQ6IHRpbWUsXG4gICAgICB9LFxuICAgICAgYnVnczogdmVyc2lvbi5idWdzLFxuICAgICAgbGljZW5zZTogdmVyc2lvbi5saWNlbnNlLFxuICAgICAgdmVyc2lvbnMsXG4gICAgfTtcblxuICAgIHJldHVybiBwa2c7XG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayB3aGV0aGVyIHRoZSBwYWNrYWdlIG1ldGFkdGEgaGFzIGVub3VnaCBkYXRhIHRvIGJlIHB1Ymxpc2hlZFxuICogQHBhcmFtIHBrZyBtZXRhZGF0YVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNQdWJsaXNoYWJsZVBhY2thZ2UocGtnOiBNYW5pZmVzdCk6IGJvb2xlYW4ge1xuICBjb25zdCBrZXlzOiBzdHJpbmdbXSA9IE9iamVjdC5rZXlzKHBrZyk7XG5cbiAgcmV0dXJuIGtleXMuaW5jbHVkZXMoJ3ZlcnNpb25zJyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYXNJbnN0YWxsU2NyaXB0KHZlcnNpb246IFZlcnNpb24pIHtcbiAgaWYgKHZlcnNpb24/LnNjcmlwdHMpIHtcbiAgICBjb25zdCBzY3JpcHRzID0gT2JqZWN0LmtleXModmVyc2lvbi5zY3JpcHRzKTtcbiAgICByZXR1cm4gKFxuICAgICAgc2NyaXB0cy5maW5kKChpdGVtKSA9PiB7XG4gICAgICAgIHJldHVybiBbJ2luc3RhbGwnLCAncHJlaW5zdGFsbCcsICdwb3N0aW5zdGFsbCddLmluY2x1ZGVzKGl0ZW0pO1xuICAgICAgfSkgIT09IHVuZGVmaW5lZFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29udmVydEFiYnJldmlhdGVkTWFuaWZlc3QobWFuaWZlc3Q6IE1hbmlmZXN0KTogQWJicmV2aWF0ZWRNYW5pZmVzdCB7XG4gIGNvbnN0IGFiYnJldmlhdGVkVmVyc2lvbnMgPSBPYmplY3Qua2V5cyhtYW5pZmVzdC52ZXJzaW9ucykucmVkdWNlKFxuICAgIChhY2M6IEFiYnJldmlhdGVkVmVyc2lvbnMsIHZlcnNpb246IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgX3ZlcnNpb24gPSBtYW5pZmVzdC52ZXJzaW9uc1t2ZXJzaW9uXTtcbiAgICAgIC8vIFRoaXMgc2hvdWxkIGJlIGFsaWduIHdpdGggdGhpcyBkb2N1bWVudFxuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL25wbS9yZWdpc3RyeS9ibG9iL21hc3Rlci9kb2NzL3Jlc3BvbnNlcy9wYWNrYWdlLW1ldGFkYXRhLm1kI2FiYnJldmlhdGVkLXZlcnNpb24tb2JqZWN0XG4gICAgICBjb25zdCBfdmVyc2lvbl9hYmJyZXZpYXRlZCA9IHtcbiAgICAgICAgbmFtZTogX3ZlcnNpb24ubmFtZSxcbiAgICAgICAgdmVyc2lvbjogX3ZlcnNpb24udmVyc2lvbixcbiAgICAgICAgZGVzY3JpcHRpb246IF92ZXJzaW9uLmRlc2NyaXB0aW9uLFxuICAgICAgICBkZXByZWNhdGVkOiBfdmVyc2lvbi5kZXByZWNhdGVkLFxuICAgICAgICBiaW46IF92ZXJzaW9uLmJpbixcbiAgICAgICAgZGlzdDogX3ZlcnNpb24uZGlzdCxcbiAgICAgICAgZW5naW5lczogX3ZlcnNpb24uZW5naW5lcyxcbiAgICAgICAgY3B1OiBfdmVyc2lvbi5jcHUsXG4gICAgICAgIG9zOiBfdmVyc2lvbi5vcyxcbiAgICAgICAgZnVuZGluZzogX3ZlcnNpb24uZnVuZGluZyxcbiAgICAgICAgZGlyZWN0b3JpZXM6IF92ZXJzaW9uLmRpcmVjdG9yaWVzLFxuICAgICAgICBkZXBlbmRlbmNpZXM6IF92ZXJzaW9uLmRlcGVuZGVuY2llcyxcbiAgICAgICAgZGV2RGVwZW5kZW5jaWVzOiBfdmVyc2lvbi5kZXZEZXBlbmRlbmNpZXMsXG4gICAgICAgIHBlZXJEZXBlbmRlbmNpZXM6IF92ZXJzaW9uLnBlZXJEZXBlbmRlbmNpZXMsXG4gICAgICAgIHBlZXJEZXBlbmRlbmNpZXNNZXRhOiBfdmVyc2lvbi5wZWVyRGVwZW5kZW5jaWVzTWV0YSxcbiAgICAgICAgb3B0aW9uYWxEZXBlbmRlbmNpZXM6IF92ZXJzaW9uLm9wdGlvbmFsRGVwZW5kZW5jaWVzLFxuICAgICAgICBidW5kbGVEZXBlbmRlbmNpZXM6IF92ZXJzaW9uLmJ1bmRsZURlcGVuZGVuY2llcyxcbiAgICAgICAgLy8gbnBtIGNsaSBzcGVjaWZpY3NcbiAgICAgICAgX2hhc1Nocmlua3dyYXA6IF92ZXJzaW9uLl9oYXNTaHJpbmt3cmFwLFxuICAgICAgICBoYXNJbnN0YWxsU2NyaXB0OiBoYXNJbnN0YWxsU2NyaXB0KF92ZXJzaW9uKSxcbiAgICAgIH07XG4gICAgICBhY2NbdmVyc2lvbl0gPSBfdmVyc2lvbl9hYmJyZXZpYXRlZDtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSxcbiAgICB7fVxuICApO1xuXG4gIGNvbnN0IGNvbnZlcnRlZE1hbmlmZXN0ID0ge1xuICAgIG5hbWU6IG1hbmlmZXN0WyduYW1lJ10sXG4gICAgW0RJU1RfVEFHU106IG1hbmlmZXN0W0RJU1RfVEFHU10sXG4gICAgdmVyc2lvbnM6IGFiYnJldmlhdGVkVmVyc2lvbnMsXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIG1vZGlmaWVkOiBtYW5pZmVzdD8udGltZT8ubW9kaWZpZWQsXG4gICAgLy8gTk9URTogc3BlY2lhbCBjYXNlIGZvciBwbnBtIGh0dHBzOi8vZ2l0aHViLmNvbS9wbnBtL3JmY3MvcHVsbC8yXG4gICAgdGltZTogbWFuaWZlc3Q/LnRpbWUsXG4gIH07XG5cbiAgLy8gQHRzLWlnbm9yZVxuICByZXR1cm4gY29udmVydGVkTWFuaWZlc3Q7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFFQTtBQVFBO0FBR0E7QUFDQTtBQUNBO0FBQTZFO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUV0RSxTQUFTQSx1QkFBdUIsQ0FBQ0MsSUFBWSxFQUFXO0VBQzdELE9BQU87SUFDTDtJQUNBQSxJQUFJO0lBQ0pDLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFDWkMsSUFB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