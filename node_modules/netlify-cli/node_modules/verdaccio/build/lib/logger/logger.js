"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createLogger = createLogger;
exports.getLogger = getLogger;
exports.logger = void 0;
exports.setup = setup;
var _debug = _interopRequireDefault(require("debug"));
var _lodash = _interopRequireDefault(require("lodash"));
var _pino = _interopRequireDefault(require("pino"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return typeof key === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (typeof input !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (typeof res !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
function isProd() {
  return process.env.NODE_ENV === 'production';
}
let logger;
exports.logger = logger;
const debug = (0, _debug.default)('verdaccio:logger');
const DEFAULT_LOG_FORMAT = isProd() ? 'json' : 'pretty';
function createLogger(options = {
  level: 'http'
}, destination = _pino.default.destination(1), format = DEFAULT_LOG_FORMAT, prettyPrintOptions) {
  if (_lodash.default.isNil(format)) {
    format = DEFAULT_LOG_FORMAT;
  }
  let pinoConfig = _objectSpread(_objectSpread({
    customLevels: {
      http: 25
    }
  }, options), {}, {
    level: options.level,
    serializers: {
      err: _pino.default.stdSerializers.err,
      req: _pino.default.stdSerializers.req,
      res: _pino.default.stdSerializers.res
    }
  });
  debug('has prettifier? %o', !isProd());
  // pretty logs are not allowed in production for performance reasons
  if ((format === DEFAULT_LOG_FORMAT || format !== 'json') && isProd() === false) {
    pinoConfig = Object.assign({}, pinoConfig, {
      // more info
      // https://github.com/pinojs/pino-pretty/issues/37
      prettyPrint: _objectSpread({
        levelFirst: true,
        prettyStamp: format === 'pretty-timestamped'
      }, prettyPrintOptions),
      prettifier: require('./formatter')
    });
  }
  const logger = (0, _pino.default)(pinoConfig, destination);
  if (process.env.DEBUG) {
    logger.on('level-change', (lvl, val, prevLvl, prevVal) => {
      debug('%s (%d) was changed to %s (%d)', lvl, val, prevLvl, prevVal);
    });
  }
  return logger;
}
function getLogger() {
  if (_lodash.default.isNil(logger)) {
    process.emitWarning('logger is not defined');
    return;
  }
  return logger;
}
const DEFAULT_LOGGER_CONF = {
  type: 'stdout',
  format: 'pretty',
  level: 'http',
  colors: true
};
function setup(options = [DEFAULT_LOGGER_CONF]) {
  var _loggerConfig, _loggerConfig2, _loggerConfig3;
  debug('setup logger');
  const isLegacyConf = Array.isArray(options);
  if (isLegacyConf) {
    const deprecateMessage = 'deprecate: multiple logger configuration is deprecated, please check the migration guide.';
    process.emitWarning(deprecateMessage);
  }

  // verdaccio 5 does not allow multiple logger configuration
  // backward compatible, pick only the first option
  // next major will thrown an error
  let loggerConfig = isLegacyConf ? options[0] : options;
  if (!((_loggerConfig = loggerConfig) !== null && _loggerConfig !== void 0 && _loggerConfig.level)) {
    loggerConfig = Object.assign({}, {
      level: 'http'
    }, loggerConfig);
  }
  const pinoConfig = {
    level: loggerConfig.level
  };
  let colors = typeof ((_loggerConfig2 = loggerConfig) === null || _loggerConfig2 === void 0 ? void 0 : _loggerConfig2.colors) === 'boolean' ? Boolean((_loggerConfig3 = loggerConfig) === null || _loggerConfig3 === void 0 ? void 0 : _loggerConfig3.colors) : process.stdout.isTTY;
  if ('EXPERIMENTAL_VERDACCIO_LOGGER_COLORS' in process.env) {
    colors = process.env.EXPERIMENTAL_VERDACCIO_LOGGER_COLORS != 'false';
  }
  const prettyPrintOptions = {
    // we hide warning since the prettifier should not be used in production
    // https://getpino.io/#/docs/pretty?id=prettifier-api
    suppressFlushSyncWarning: true,
    colors
  };
  if (loggerConfig.type === 'file') {
    debug('logging file enabled');
    const destination = _pino.default.destination(loggerConfig.path);
    process.on('SIGUSR2', () => destination.reopen());
    exports.logger = logger = createLogger(pinoConfig, destination, loggerConfig.format, prettyPrintOptions);
  } else if (loggerConfig.type === 'rotating-file') {
    process.emitWarning('rotating-file type is not longer supported, consider use [logrotate] instead');
    debug('logging stdout enabled');
    exports.logger = logger = createLogger(pinoConfig, _pino.default.destination(1), loggerConfig.format, prettyPrintOptions);
  } else {
    debug('logging stdout enabled');
    exports.logger = logger = createLogger(pinoConfig, _pino.default.destination(1), loggerConfig.format, prettyPrintOptions);
  }
  if (isProd()) {
    // why only on prod? https://github.com/pinojs/pino/issues/920#issuecomment-710807667
    const finalHandler = _pino.default.final(logger, (err, finalLogger, event) => {
      finalLogger.info(`${event} caught`);
      if (err) {
        finalLogger.error(err, 'error caused exit');
      }
      process.exit(err ? 1 : 0);
    });
    process.on('uncaughtException', err => finalHandler(err, 'uncaughtException'));
    process.on('unhandledRejection', err => finalHandler(err, 'unhandledRejection'));
    process.on('beforeExit', () => finalHandler(null, 'beforeExit'));
    process.on('exit', () => finalHandler(null, 'exit'));
    process.on('uncaughtException', err => finalHandler(err, 'uncaughtException'));
    process.on('SIGINT', () => finalHandler(null, 'SIGINT'));
    process.on('SIGQUIT', () => finalHandler(null, 'SIGQUIT'));
    process.on('SIGTERM', () => finalHandler(null, 'SIGTERM'));
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJpc1Byb2QiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJsb2dnZXIiLCJkZWJ1ZyIsImJ1aWxkRGVidWciLCJERUZBVUxUX0xPR19GT1JNQVQiLCJjcmVhdGVMb2dnZXIiLCJvcHRpb25zIiwibGV2ZWwiLCJkZXN0aW5hdGlvbiIsInBpbm8iLCJmb3JtYXQiLCJwcmV0dHlQcmludE9wdGlvbnMiLCJfIiwiaXNOaWwiLCJwaW5vQ29uZmlnIiwiY3VzdG9tTGV2ZWxzIiwiaHR0cCIsInNlcmlhbGl6ZXJzIiwiZXJyIiwic3RkU2VyaWFsaXplcnMiLCJyZXEiLCJyZXMiLCJPYmplY3QiLCJhc3NpZ24iLCJwcmV0dHlQcmludCIsImxldmVsRmlyc3QiLCJwcmV0dHlTdGFtcCIsInByZXR0aWZpZXIiLCJyZXF1aXJlIiwiREVCVUciLCJvbiIsImx2bCIsInZhbCIsInByZXZMdmwiLCJwcmV2VmFsIiwiZ2V0TG9nZ2VyIiwiZW1pdFdhcm5pbmciLCJERUZBVUxUX0xPR0dFUl9DT05GIiwidHlwZSIsImNvbG9ycyIsInNldHVwIiwiaXNMZWdhY3lDb25mIiwiQXJyYXkiLCJpc0FycmF5IiwiZGVwcmVjYXRlTWVzc2FnZSIsImxvZ2dlckNvbmZpZyIsIkJvb2xlYW4iLCJzdGRvdXQiLCJpc1RUWSIsIkVYUEVSSU1FTlRBTF9WRVJEQUNDSU9fTE9HR0VSX0NPTE9SUyIsInN1cHByZXNzRmx1c2hTeW5jV2FybmluZyIsInBhdGgiLCJyZW9wZW4iLCJmaW5hbEhhbmRsZXIiLCJmaW5hbCIsImZpbmFsTG9nZ2VyIiwiZXZlbnQiLCJpbmZvIiwiZXJyb3IiLCJleGl0Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9sb2dnZXIvbG9nZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBidWlsZERlYnVnIGZyb20gJ2RlYnVnJztcbmltcG9ydCB7IHllbGxvdyB9IGZyb20gJ2tsZXVyJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgcGlubyBmcm9tICdwaW5vJztcblxuZnVuY3Rpb24gaXNQcm9kKCkge1xuICByZXR1cm4gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJztcbn1cblxuZXhwb3J0IGxldCBsb2dnZXI7XG5jb25zdCBkZWJ1ZyA9IGJ1aWxkRGVidWcoJ3ZlcmRhY2Npbzpsb2dnZXInKTtcbmNvbnN0IERFRkFVTFRfTE9HX0ZPUk1BVCA9IGlzUHJvZCgpID8gJ2pzb24nIDogJ3ByZXR0eSc7XG5cbmV4cG9ydCB0eXBlIExvZ1BsdWdpbiA9IHtcbiAgZGVzdDogc3RyaW5nO1xuICBvcHRpb25zPzogYW55W107XG59O1xuXG5leHBvcnQgdHlwZSBMb2dUeXBlID0gJ2ZpbGUnIHwgJ3N0ZG91dCc7XG5leHBvcnQgdHlwZSBMb2dGb3JtYXQgPSAnanNvbicgfCAncHJldHR5LXRpbWVzdGFtcGVkJyB8ICdwcmV0dHknO1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTG9nZ2VyKFxuICBvcHRpb25zID0geyBsZXZlbDogJ2h0dHAnIH0sXG4gIGRlc3RpbmF0aW9uID0gcGluby5kZXN0aW5hdGlvbigxKSxcbiAgZm9ybWF0OiBMb2dGb3JtYXQgPSBERUZBVUxUX0xPR19GT1JNQVQsXG4gIHByZXR0eVByaW50T3B0aW9uc1xuKSB7XG4gIGlmIChfLmlzTmlsKGZvcm1hdCkpIHtcbiAgICBmb3JtYXQgPSBERUZBVUxUX0xPR19GT1JNQVQ7XG4gIH1cblxuICBsZXQgcGlub0NvbmZpZyA9IHtcbiAgICBjdXN0b21MZXZlbHM6IHtcbiAgICAgIGh0dHA6IDI1LFxuICAgIH0sXG4gICAgLi4ub3B0aW9ucyxcbiAgICBsZXZlbDogb3B0aW9ucy5sZXZlbCxcbiAgICBzZXJpYWxpemVyczoge1xuICAgICAgZXJyOiBwaW5vLnN0ZFNlcmlhbGl6ZXJzLmVycixcbiAgICAgIHJlcTogcGluby5zdGRTZXJpYWxpemVycy5yZXEsXG4gICAgICByZXM6IHBpbm8uc3RkU2VyaWFsaXplcnMucmVzLFxuICAgIH0sXG4gIH07XG5cbiAgZGVidWcoJ2hhcyBwcmV0dGlmaWVyPyAlbycsICFpc1Byb2QoKSk7XG4gIC8vIHByZXR0eSBsb2dzIGFyZSBub3QgYWxsb3dlZCBpbiBwcm9kdWN0aW9uIGZvciBwZXJmb3JtYW5jZSByZWFzb25zXG4gIGlmICgoZm9ybWF0ID09PSBERUZBVUxUX0xPR19GT1JNQVQgfHwgZm9ybWF0ICE9PSAnanNvbicpICYmIGlzUHJvZCgpID09PSBmYWxzZSkge1xuICAgIHBpbm9Db25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBwaW5vQ29uZmlnLCB7XG4gICAgICAvLyBtb3JlIGluZm9cbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9waW5vanMvcGluby1wcmV0dHkvaXNzdWVzLzM3XG4gICAgICBwcmV0dHlQcmludDoge1xuICAgICAgICBsZXZlbEZpcnN0OiB0cnVlLFxuICAgICAgICBwcmV0dHlTdGFtcDogZm9ybWF0ID09PSAncHJldHR5LXRpbWVzdGFtcGVkJyxcbiAgICAgICAgLi4ucHJldHR5UHJpbnRPcHRpb25zLFxuICAgICAgfSxcbiAgICAgIHByZXR0aWZpZXI6IHJlcXVpcmUoJy4vZm9ybWF0dGVyJyksXG4gICAgfSk7XG4gIH1cbiAgY29uc3QgbG9nZ2VyID0gcGlubyhwaW5vQ29uZmlnLCBkZXN0aW5hdGlvbik7XG5cbiAgaWYgKHByb2Nlc3MuZW52LkRFQlVHKSB7XG4gICAgbG9nZ2VyLm9uKCdsZXZlbC1jaGFuZ2UnLCAobHZsLCB2YWwsIHByZXZMdmwsIHByZXZWYWwpID0+IHtcbiAgICAgIGRlYnVnKCclcyAoJWQpIHdhcyBjaGFuZ2VkIHRvICVzICglZCknLCBsdmwsIHZhbCwgcHJldkx2bCwgcHJldlZhbCk7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gbG9nZ2VyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0TG9nZ2VyKCkge1xuICBpZiAoXy5pc05pbChsb2dnZXIpKSB7XG4gICAgcHJvY2Vzcy5lbWl0V2FybmluZygnbG9nZ2VyIGlzIG5vdCBkZWZpbmVkJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcmV0dXJuIGxvZ2dlcjtcbn1cblxuY29uc3QgREVGQVVMVF9MT0dHRVJfQ09ORjogTG9nZ2VyQ29uZmlnSXRlbSA9IHtcbiAgdHlwZTogJ3N0ZG91dCcsXG4gIGZvcm1hdDogJ3ByZXR0eScsXG4gIGxldmVsOiAnaHR0cCcsXG4gIGNvbG9yczogdHJ1ZSxcbn07XG5cbmV4cG9ydCB0eXBlIExvZ2dlckNvbmZpZ0l0ZW0gPSB7XG4gIHR5cGU/OiBMb2dUeXBlO1xuICBwbHVnaW4/OiBMb2dQbHVnaW47XG4gIGZvcm1hdD86IExvZ0Zvcm1hdDtcbiAgcGF0aD86IHN0cmluZztcbiAgbGV2ZWw/OiBzdHJpbmc7XG4gIGNvbG9ycz86IGJvb2xlYW47XG59O1xuXG5leHBvcnQgdHlwZSBMb2dnZXJDb25maWcgPSBMb2dnZXJDb25maWdJdGVtW107XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXR1cChvcHRpb25zOiBMb2dnZXJDb25maWcgfCBMb2dnZXJDb25maWdJdGVtID0gW0RFRkFVTFRfTE9HR0VSX0NPTkZdKSB7XG4gIGRlYnVnKCdzZXR1cCBsb2dnZXInKTtcbiAgY29uc3QgaXNMZWdhY3lDb25mID0gQXJyYXkuaXNBcnJheShvcHRpb25zKTtcbiAgaWYgKGlzTGVnYWN5Q29uZikge1xuICAgIGNvbnN0IGRlcHJlY2F0ZU1lc3NhZ2UgPVxuICAgICAgJ2RlcHJlY2F0ZTogbXVsdGlwbGUgbG9nZ2VyIGNvbmZpZ3VyYXRpb24gaXMgZGVwcmVjYXRlZCwgcGxlYXNlIGNoZWNrIHRoZSBtaWdyYXRpb24gZ3VpZGUuJztcbiAgICBwcm9jZXNzLmVtaXRXYXJuaW5nKGRlcHJlY2F0ZU1lc3NhZ2UpO1xuICB9XG5cbiAgLy8gdmVyZGFjY2lvIDUgZG9lcyBub3QgYWxsb3cgbXVsdGlwbGUgbG9nZ2VyIGNvbmZpZ3VyYXRpb25cbiAgLy8gYmFja3dhcmQgY29tcGF0aWJsZSwgcGljayBvbmx5IHRoZSBmaXJzdCBvcHRpb25cbiAgLy8gbmV4dCBtYWpvciB3aWxsIHRocm93biBhbiBlcnJvclxuICBsZXQgbG9nZ2VyQ29uZmlnID0gaXNMZWdhY3lDb25mID8gb3B0aW9uc1swXSA6IG9wdGlvbnM7XG4gIGlmICghbG9nZ2VyQ29uZmlnPy5sZXZlbCkge1xuICAgIGxvZ2dlckNvbmZpZyA9IE9iamVjdC5hc3NpZ24oXG4gICAgICB7fSxcbiAgICAgIHtcbiAgICAgICAgbGV2ZWw6ICdodHRwJyxcbiAgICAgIH0sXG4gICAgICBsb2dnZXJDb25maWdcbiAgICApO1xuICB9XG4gIGNvbnN0IHBpbm9Db25maWcgPSB7IGxldmVsOiBsb2dnZXJDb25maWcubGV2ZWwgfTtcbiAgbGV0IGNvbG9ycyA9XG4gICAgdHlwZW9mIGxvZ2dlckNvbmZpZz8uY29sb3JzID09PSAnYm9vbGVhbidcbiAgICAgID8gQm9vbGVhbihsb2dnZXJDb25maWc/LmNvbG9ycylcbiAgICAgIDogcHJvY2Vzcy5zdGRvdXQuaXNUVFk7XG4gIGlmICgnRVhQRVJJTUVOVEFMX1ZFUkRBQ0NJT19MT0dHRVJfQ09MT1JTJyBpbiBwcm9jZXNzLmVudikge1xuICAgIGNvbG9ycyA9IHByb2Nlc3MuZW52LkVYUEVSSU1FTlRBTF9WRVJEQUNDSU9fTE9HR0VSX0NPTE9SUyAhPSAnZmFsc2UnO1xuICB9XG4gIGNvbnN0IHByZXR0eVByaW50T3B0aW9ucyA9IHtcbiAgICAvLyB3ZSBoaWRlIHdhcm5pbmcgc2luY2UgdGhlIHByZXR0aWZpZXIgc2hvdWxkIG5vdCBiZSB1c2VkIGluIHByb2R1Y3Rpb25cbiAgICAvLyBodHRwczovL2dldHBpbm8uaW8vIy9kb2NzL3ByZXR0eT9pZD1wcmV0dGlmaWVyLWFwaVxuICAgIHN1cHByZXNzRmx1c2hTeW5jV2FybmluZzogdHJ1ZSxcbiAgICBjb2xvcnMsXG4gIH07XG4gIGlmIChsb2dnZXJDb25maWcudHlwZSA9PT0gJ2ZpbGUnKSB7XG4gICAgZGVidWcoJ2xvZ2dpbmcgZmlsZSBlbmFibGVkJyk7XG4gICAgY29uc3QgZGVzdGluYXRpb24gPSBwaW5vLmRlc3RpbmF0aW9uKGxvZ2dlckNvbmZpZy5wYXRoKTtcbiAgICBwcm9jZXNzLm9uKCdTSUdVU1IyJywgKCkgPT4gZGVzdGluYXRpb24ucmVvcGVuKCkpO1xuICAgIGxvZ2dlciA9IGNyZWF0ZUxvZ2dlcihwaW5vQ29uZmlnLCBkZXN0aW5hdGlvbiwgbG9nZ2VyQ29uZmlnLmZvcm1hdCwgcHJldHR5UHJpbnRPcHRpb25zKTtcbiAgfSBlbHNlIGlmIChsb2dnZXJDb25maWcudHlwZSA9PT0gJ3JvdGF0aW5nLWZpbGUnKSB7XG4gICAgcHJvY2Vzcy5lbWl0V2FybmluZyhcbiAgICAgICdyb3RhdGluZy1maWxlIHR5cGUgaXMgbm90IGxvbmdlciBzdXBwb3J0ZWQsIGNvbnNpZGVyIHVzZSBbbG9ncm90YXRlXSBpbnN0ZWFkJ1xuICAgICk7XG4gICAgZGVidWcoJ2xvZ2dpbmcgc3Rkb3V0IGVuYWJsZWQnKTtcbiAgICBsb2dnZXIgPSBjcmVhdGVMb2dnZXIocGlub0NvbmZpZywgcGluby5kZXN0aW5hdGlvbigxKSwgbG9nZ2VyQ29uZmlnLmZvcm1hdCwgcHJldHR5UHJpbnRPcHRpb25zKTtcbiAgfSBlbHNlIHtcbiAgICBkZWJ1ZygnbG9nZ2luZyBzdGRvdXQgZW5hYmxlZCcpO1xuICAgIGxvZ2dlciA9IGNyZWF0ZUxvZ2dlcihwaW5vQ29uZmlnLCBwaW5vLmRlc3RpbmF0aW9uKDEpLCBsb2dnZXJDb25maWcuZm9ybWF0LCBwcmV0dHlQcmludE9wdGlvbnMpO1xuICB9XG5cbiAgaWYgKGlzUHJvZCgpKSB7XG4gICAgLy8gd2h5IG9ubHkgb24gcHJvZD8gaHR0cHM6Ly9naXRodWIuY29tL3Bpbm9qcy9waW5vL2lzc3Vlcy85MjAjaXNzdWVjb21tZW50LTcxMDgwNzY2N1xuICAgIGNvbnN0IGZpbmFsSGFuZGxlciA9IHBpbm8uZmluYWwobG9nZ2VyLCAoZXJyLCBmaW5hbExvZ2dlciwgZXZlbnQpID0+IHtcbiAgICAgIGZpbmFsTG9nZ2VyLmluZm8oYCR7ZXZlbnR9IGNhdWdodGApO1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBmaW5hbExvZ2dlci5lcnJvcihlcnIsICdlcnJvciBjYXVzZWQgZXhpdCcpO1xuICAgICAgfVxuICAgICAgcHJvY2Vzcy5leGl0KGVyciA/IDEgOiAwKTtcbiAgICB9KTtcblxuICAgIHByb2Nlc3Mub24oJ3VuY2F1Z2h0RXhjZXB0aW9uJywgKGVycikgPT4gZmluYWxIYW5kbGVyKGVyciwgJ3VuY2F1Z2h0RXhjZXB0aW9uJykpO1xuICAgIHByb2Nlc3Mub24oJ3VuaGFuZGxlZFJlamVjdGlvbicsIChlcnIpID0+IGZpbmFsSGFuZGxlcihlcnIgYXMgRXJyb3IsICd1bmhhbmRsZWRSZWplY3Rpb24nKSk7XG4gICAgcHJvY2Vzcy5vbignYmVmb3JlRXhpdCcsICgpID0+IGZpbmFsSGFuZGxlcihudWxsLCAnYmVmb3JlRXhpdCcpKTtcbiAgICBwcm9jZXNzLm9uKCdleGl0JywgKCkgPT4gZmluYWxIYW5kbGVyKG51bGwsICdleGl0JykpO1xuICAgIHByb2Nlc3Mub24oJ3VuY2F1Z2h0RXhjZXB0aW9uJywgKGVycikgPT4gZmluYWxIYW5kbGVyKGVyciwgJ3VuY2F1Z2h0RXhjZXB0aW9uJykpO1xuICAgIHByb2Nlc3Mub24oJ1NJR0lOVCcsICgpID0+IGZpbmFsSGFuZGxlcihudWxsLCAnU0lHSU5UJykpO1xuICAgIHByb2Nlc3Mub24oJ1NJR1FVSVQnLCAoKSA9PiBmaW5hbEhhbmRsZXIobnVsbCwgJ1NJR1FVSVQnKSk7XG4gICAgcHJvY2Vzcy5vbignU0lHVEVSTScsICgpID0+IGZpbmFsSGFuZGxlcihudWxsLCAnU0lHVEVSTScpKTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTtBQUVBO0FBQ0E7QUFBd0I7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRXhCLFNBQVNBLE1BQU0sR0FBRztFQUNoQixPQUFPQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsUUFBUSxLQUFLLFlBQVk7QUFDOUM7QUFFTyxJQUFJQyxNQUFNO0FBQUM7QUFDbEIsTUFBTUMsS0FBSyxHQUFHLElBQUFDLGNBQVUsRUFBQyxr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