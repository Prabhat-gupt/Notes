{"version":3,"sources":["../../src/main.js"],"names":["env","handleOfflineError","readCachedVersions","writeCachedVersions","fetchIndex","normalizeIndex","getOpts","allNodeVersions","opts","fetch","fetchNodeOpts","versionsInfo","getAllVersions","processCachedVersions","undefined","TEST_CACHE_FILENAME","getVersionsInfo","cachedVersions","index","error"],"mappings":"AAAA,OAASA,GAAT,KAAoB,SAApB;;AAEA,OAASC,kBAAT,KAAmC,oBAAnC;AACA,OAASC,kBAAT,CAA6BC,mBAA7B,KAAwD,iBAAxD;AACA,OAASC,UAAT,KAA2B,YAA3B;AACA,OAASC,cAAT,KAA+B,gBAA/B;AACA,OAASC,OAAT,KAAwB,cAAxB;;;;AAIA,cAAe,eAAeC,CAAAA,eAAf,CAA+BC,IAA/B,CAAqC;AAClD,KAAM,CAAEC,KAAF,CAAS,GAAGC,aAAZ,EAA8BJ,OAAO,CAACE,IAAD,CAA3C;AACA,KAAMG,CAAAA,YAAY,CAAG,KAAMC,CAAAA,cAAc,CAACH,KAAD,CAAQC,aAAR,CAAzC;AACA,MAAOC,CAAAA,YAAP;AACD;;;AAGD,KAAMC,CAAAA,cAAc,CAAG,eAAgBH,KAAhB,CAAuBC,aAAvB,CAAsC;AAC3D;AACEG,qBAAqB,GAAKC,SAA1B;AACAL,KAAK,GAAK,IADV;AAEA,CAACT,GAAG,CAACe,mBAHP;AAIE;AACA,MAAOF,CAAAA,qBAAP;AACD;;AAED,KAAMF,CAAAA,YAAY,CAAG,KAAMK,CAAAA,eAAe,CAACP,KAAD,CAAQC,aAAR,CAA1C;;;AAGAG,qBAAqB,CAAGF,YAAxB;;AAEA,MAAOA,CAAAA,YAAP;AACD,CAfD;;;AAkBA,GAAIE,CAAAA,qBAAJ;;;AAGA,KAAMG,CAAAA,eAAe,CAAG,eAAgBP,KAAhB,CAAuBC,aAAvB,CAAsC;AAC5D,KAAMO,CAAAA,cAAc,CAAG,KAAMf,CAAAA,kBAAkB,CAACO,KAAD,CAA/C;;AAEA,GAAIQ,cAAc,GAAKH,SAAvB,CAAkC;AAChC,MAAOG,CAAAA,cAAP;AACD;;AAED,GAAI;AACF,KAAMC,CAAAA,KAAK,CAAG,KAAMd,CAAAA,UAAU,CAACM,aAAD,CAA9B;AACA,KAAMC,CAAAA,YAAY,CAAGN,cAAc,CAACa,KAAD,CAAnC;AACA,KAAMf,CAAAA,mBAAmB,CAACQ,YAAD,CAAzB;AACA,MAAOA,CAAAA,YAAP;AACD,CAAC,MAAOQ,KAAP,CAAc;AACd,MAAOlB,CAAAA,kBAAkB,CAACkB,KAAD,CAAzB;AACD;AACF,CAfD","sourcesContent":["import { env } from 'process'\n\nimport { handleOfflineError } from './cache/offline.js'\nimport { readCachedVersions, writeCachedVersions } from './cache/read.js'\nimport { fetchIndex } from './fetch.js'\nimport { normalizeIndex } from './normalize.js'\nimport { getOpts } from './options.js'\n\n// Fetch all available Node versions by making a HTTP request to Node website.\n// Versions are already sorted from newest to oldest.\nexport default async function allNodeVersions(opts) {\n  const { fetch, ...fetchNodeOpts } = getOpts(opts)\n  const versionsInfo = await getAllVersions(fetch, fetchNodeOpts)\n  return versionsInfo\n}\n\n// We cache the HTTP request once per process.\nconst getAllVersions = async function (fetch, fetchNodeOpts) {\n  if (\n    processCachedVersions !== undefined &&\n    fetch !== true &&\n    !env.TEST_CACHE_FILENAME\n  ) {\n    return processCachedVersions\n  }\n\n  const versionsInfo = await getVersionsInfo(fetch, fetchNodeOpts)\n\n  // eslint-disable-next-line fp/no-mutation, require-atomic-updates\n  processCachedVersions = versionsInfo\n\n  return versionsInfo\n}\n\n// eslint-disable-next-line fp/no-let, init-declarations\nlet processCachedVersions\n\n// We also cache the HTTP request for one hour using a cache file.\nconst getVersionsInfo = async function (fetch, fetchNodeOpts) {\n  const cachedVersions = await readCachedVersions(fetch)\n\n  if (cachedVersions !== undefined) {\n    return cachedVersions\n  }\n\n  try {\n    const index = await fetchIndex(fetchNodeOpts)\n    const versionsInfo = normalizeIndex(index)\n    await writeCachedVersions(versionsInfo)\n    return versionsInfo\n  } catch (error) {\n    return handleOfflineError(error)\n  }\n}\n"],"file":"src/main.js"}