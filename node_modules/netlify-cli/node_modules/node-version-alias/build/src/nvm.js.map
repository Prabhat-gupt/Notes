{"version":3,"sources":["../../src/nvm.js"],"names":["execFile","join","env","promisify","pathExists","pExecFile","getNvmCustomAlias","alias","runNvmCommand","getNvmSystemVersion","command","NVM_DIR","nvmPath","stdout","trim"],"mappings":"AAAA,OAASA,QAAT,KAAyB,eAAzB;AACA,OAASC,IAAT,KAAqB,MAArB;AACA,OAASC,GAAT,KAAoB,SAApB;AACA,OAASC,SAAT,KAA0B,MAA1B;;AAEA,MAAOC,CAAAA,UAAP,KAAuB,aAAvB;;AAEA,KAAMC,CAAAA,SAAS,CAAGF,SAAS,CAACH,QAAD,CAA3B;;;AAGA,MAAO,MAAMM,CAAAA,iBAAiB,CAAG,SAAUC,KAAV,CAAiB;AAChD,MAAOC,CAAAA,aAAa,CAAE,aAAYD,KAAM,EAApB,CAApB;AACD,CAFM;;;AAKP,MAAO,MAAME,CAAAA,mBAAmB,CAAG,UAAY;AAC7C,MAAOD,CAAAA,aAAa,CAAC,6CAAD,CAApB;AACD,CAFM;;;AAKP,KAAMA,CAAAA,aAAa,CAAG,eAAgBE,OAAhB,CAAyB;AAC7C,GAAI,CAACR,GAAG,CAACS,OAAT,CAAkB;AAChB;AACD;;AAED,KAAMC,CAAAA,OAAO,CAAGX,IAAI,CAACC,GAAG,CAACS,OAAL,CAAc,QAAd,CAApB;;AAEA,GAAI,EAAE,KAAMP,CAAAA,UAAU,CAACQ,OAAD,CAAlB,CAAJ,CAAkC;AAChC;AACD;;AAED,GAAI;AACF,KAAM,CAAEC,MAAF,EAAa,KAAMR,CAAAA,SAAS,CAAC,MAAD,CAAS;AACzC,IADyC;AAExC,WAAUO,OAAQ,QAAOF,OAAQ,EAFO,CAAT,CAAlC;;AAIA,MAAOG,CAAAA,MAAM,CAACC,IAAP,EAAP;;;;;AAKD,CAAC,KAAM,CAAE;AACX,CAtBD","sourcesContent":["import { execFile } from 'child_process'\nimport { join } from 'path'\nimport { env } from 'process'\nimport { promisify } from 'util'\n\nimport pathExists from 'path-exists'\n\nconst pExecFile = promisify(execFile)\n\n// Retrieve nvm custom alias.\nexport const getNvmCustomAlias = function (alias) {\n  return runNvmCommand(`nvm_alias ${alias}`)\n}\n\n// Retrieve Node.js version outside nvm\nexport const getNvmSystemVersion = function () {\n  return runNvmCommand('nvm deactivate >/dev/null && node --version')\n}\n\n// nvm requires sourcing `nvm.sh` first\nconst runNvmCommand = async function (command) {\n  if (!env.NVM_DIR) {\n    return\n  }\n\n  const nvmPath = join(env.NVM_DIR, 'nvm.sh')\n\n  if (!(await pathExists(nvmPath))) {\n    return\n  }\n\n  try {\n    const { stdout } = await pExecFile('bash', [\n      '-c',\n      `source \"${nvmPath}\" && ${command}`,\n    ])\n    return stdout.trim()\n    // Among possible errors:\n    //   - Setup issue: Bash or nvm not installed, Bash setup error, etc.\n    //   - Custom alias: alias does not exist\n    //   - `system`: no system `node` outside `nvm`\n  } catch {}\n}\n"],"file":"src/nvm.js"}