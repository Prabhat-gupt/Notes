{"version":3,"file":"pkg-utils.js","names":["loadPrivatePackages","path","logger","list","emptyDatabase","secret","data","fs","readFileSync","_","isNil","db","JSON","parse","err","error","mesage","Error","isEmpty"],"sources":["../src/pkg-utils.ts"],"sourcesContent":["import fs from 'fs';\n\nimport _ from 'lodash';\nimport { LocalStorage, StorageList, Logger } from '@verdaccio/types';\n\nexport function loadPrivatePackages(path: string, logger: Logger): LocalStorage {\n  const list: StorageList = [];\n  const emptyDatabase = { list, secret: '' };\n  const data = fs.readFileSync(path, 'utf8');\n\n  if (_.isNil(data)) {\n    // readFileSync is platform specific, FreeBSD might return null\n    return emptyDatabase;\n  }\n\n  let db;\n  try {\n    db = JSON.parse(data);\n  } catch (err: any) {\n    logger.error(\n      {\n        err: err.mesage,\n        path,\n      }, // eslint-disable-next-line max-len\n      `Package database file corrupted (invalid JSON), please check the error @{err}.\\nFile Path: @{path}`\n    );\n    throw Error('Package database file corrupted (invalid JSON)');\n  }\n\n  if (_.isEmpty(db)) {\n    return emptyDatabase;\n  }\n\n  return db;\n}\n"],"mappings":";;;;;;;AAAA;;AAEA;;;;AAGO,SAASA,mBAAT,CAA6BC,IAA7B,EAA2CC,MAA3C,EAAyE;EAC9E,MAAMC,IAAiB,GAAG,EAA1B;EACA,MAAMC,aAAa,GAAG;IAAED,IAAF;IAAQE,MAAM,EAAE;EAAhB,CAAtB;;EACA,MAAMC,IAAI,GAAGC,WAAA,CAAGC,YAAH,CAAgBP,IAAhB,EAAsB,MAAtB,CAAb;;EAEA,IAAIQ,eAAA,CAAEC,KAAF,CAAQJ,IAAR,CAAJ,EAAmB;IACjB;IACA,OAAOF,aAAP;EACD;;EAED,IAAIO,EAAJ;;EACA,IAAI;IACFA,EAAE,GAAGC,IAAI,CAACC,KAAL,CAAWP,IAAX,CAAL;EACD,CAFD,CAEE,OAAOQ,GAAP,EAAiB;IACjBZ,MAAM,CAACa,KAAP,CACE;MACED,GAAG,EAAEA,GAAG,CAACE,MADX;MAEEf;IAFF,CADF,EAIK;IACF,oGALH;IAOA,MAAMgB,KAAK,CAAC,gDAAD,CAAX;EACD;;EAED,IAAIR,eAAA,CAAES,OAAF,CAAUP,EAAV,CAAJ,EAAmB;IACjB,OAAOP,aAAP;EACD;;EAED,OAAOO,EAAP;AACD"}