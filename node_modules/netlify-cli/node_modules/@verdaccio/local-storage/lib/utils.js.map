{"version":3,"file":"utils.js","names":["getFileStats","packagePath","Promise","resolve","reject","fs","stat","err","stats","_","isNil","readDirectory","readdir","scopedPackages","hasScope","file","match","findPackages","storagePath","validationHandler","listPackages","scopePath","path","storageDirs","directory","scopeDirectory","scopedDirName","push","name","error"],"sources":["../src/utils.ts"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\n\nimport _ from 'lodash';\n\nexport function getFileStats(packagePath: string): Promise<fs.Stats> {\n  return new Promise((resolve, reject): void => {\n    fs.stat(packagePath, (err, stats) => {\n      if (_.isNil(err) === false) {\n        return reject(err);\n      }\n      resolve(stats);\n    });\n  });\n}\n\nexport function readDirectory(packagePath: string): Promise<string[]> {\n  return new Promise((resolve, reject): void => {\n    fs.readdir(packagePath, (err, scopedPackages) => {\n      if (_.isNil(err) === false) {\n        return reject(err);\n      }\n\n      resolve(scopedPackages);\n    });\n  });\n}\n\nfunction hasScope(file: string): boolean {\n  return file.match(/^@/) !== null;\n}\n\n/* eslint-disable no-async-promise-executor */\nexport async function findPackages(\n  storagePath: string,\n  validationHandler: Function\n): Promise<{ name: string; path: string }[]> {\n  const listPackages: { name: string; path: string }[] = [];\n  return new Promise(async (resolve, reject) => {\n    try {\n      const scopePath = path.resolve(storagePath);\n      const storageDirs = await readDirectory(scopePath);\n      for (const directory of storageDirs) {\n        // we check whether has 2nd level\n        if (hasScope(directory)) {\n          // we read directory multiple\n          const scopeDirectory = path.resolve(storagePath, directory);\n          const scopedPackages = await readDirectory(scopeDirectory);\n          for (const scopedDirName of scopedPackages) {\n            if (validationHandler(scopedDirName)) {\n              // we build the complete scope path\n              const scopePath = path.resolve(storagePath, directory, scopedDirName);\n              // list content of such directory\n              listPackages.push({\n                name: `${directory}/${scopedDirName}`,\n                path: scopePath,\n              });\n            }\n          }\n        } else {\n          // otherwise we read as single level\n          if (validationHandler(directory)) {\n            const scopePath = path.resolve(storagePath, directory);\n            listPackages.push({\n              name: directory,\n              path: scopePath,\n            });\n          }\n        }\n      }\n    } catch (error) {\n      reject(error);\n    }\n\n    resolve(listPackages);\n  });\n}\n/* eslint-enable no-async-promise-executor */\n"],"mappings":";;;;;;;;;AAAA;;AACA;;AAEA;;;;AAEO,SAASA,YAAT,CAAsBC,WAAtB,EAA8D;EACnE,OAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAA2B;IAC5CC,WAAA,CAAGC,IAAH,CAAQL,WAAR,EAAqB,CAACM,GAAD,EAAMC,KAAN,KAAgB;MACnC,IAAIC,eAAA,CAAEC,KAAF,CAAQH,GAAR,MAAiB,KAArB,EAA4B;QAC1B,OAAOH,MAAM,CAACG,GAAD,CAAb;MACD;;MACDJ,OAAO,CAACK,KAAD,CAAP;IACD,CALD;EAMD,CAPM,CAAP;AAQD;;AAEM,SAASG,aAAT,CAAuBV,WAAvB,EAA+D;EACpE,OAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAA2B;IAC5CC,WAAA,CAAGO,OAAH,CAAWX,WAAX,EAAwB,CAACM,GAAD,EAAMM,cAAN,KAAyB;MAC/C,IAAIJ,eAAA,CAAEC,KAAF,CAAQH,GAAR,MAAiB,KAArB,EAA4B;QAC1B,OAAOH,MAAM,CAACG,GAAD,CAAb;MACD;;MAEDJ,OAAO,CAACU,cAAD,CAAP;IACD,CAND;EAOD,CARM,CAAP;AASD;;AAED,SAASC,QAAT,CAAkBC,IAAlB,EAAyC;EACvC,OAAOA,IAAI,CAACC,KAAL,CAAW,IAAX,MAAqB,IAA5B;AACD;AAED;;;AACO,eAAeC,YAAf,CACLC,WADK,EAELC,iBAFK,EAGsC;EAC3C,MAAMC,YAA8C,GAAG,EAAvD;EACA,OAAO,IAAIlB,OAAJ,CAAY,OAAOC,OAAP,EAAgBC,MAAhB,KAA2B;IAC5C,IAAI;MACF,MAAMiB,SAAS,GAAGC,aAAA,CAAKnB,OAAL,CAAae,WAAb,CAAlB;;MACA,MAAMK,WAAW,GAAG,MAAMZ,aAAa,CAACU,SAAD,CAAvC;;MACA,KAAK,MAAMG,SAAX,IAAwBD,WAAxB,EAAqC;QACnC;QACA,IAAIT,QAAQ,CAACU,SAAD,CAAZ,EAAyB;UACvB;UACA,MAAMC,cAAc,GAAGH,aAAA,CAAKnB,OAAL,CAAae,WAAb,EAA0BM,SAA1B,CAAvB;;UACA,MAAMX,cAAc,GAAG,MAAMF,aAAa,CAACc,cAAD,CAA1C;;UACA,KAAK,MAAMC,aAAX,IAA4Bb,cAA5B,EAA4C;YAC1C,IAAIM,iBAAiB,CAACO,aAAD,CAArB,EAAsC;cACpC;cACA,MAAML,SAAS,GAAGC,aAAA,CAAKnB,OAAL,CAAae,WAAb,EAA0BM,SAA1B,EAAqCE,aAArC,CAAlB,CAFoC,CAGpC;;;cACAN,YAAY,CAACO,IAAb,CAAkB;gBAChBC,IAAI,EAAG,GAAEJ,SAAU,IAAGE,aAAc,EADpB;gBAEhBJ,IAAI,EAAED;cAFU,CAAlB;YAID;UACF;QACF,CAfD,MAeO;UACL;UACA,IAAIF,iBAAiB,CAACK,SAAD,CAArB,EAAkC;YAChC,MAAMH,SAAS,GAAGC,aAAA,CAAKnB,OAAL,CAAae,WAAb,EAA0BM,SAA1B,CAAlB;;YACAJ,YAAY,CAACO,IAAb,CAAkB;cAChBC,IAAI,EAAEJ,SADU;cAEhBF,IAAI,EAAED;YAFU,CAAlB;UAID;QACF;MACF;IACF,CA/BD,CA+BE,OAAOQ,KAAP,EAAc;MACdzB,MAAM,CAACyB,KAAD,CAAN;IACD;;IAED1B,OAAO,CAACiB,YAAD,CAAP;EACD,CArCM,CAAP;AAsCD;AACD"}