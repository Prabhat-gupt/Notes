{"version":3,"file":"lock.spec.js","names":["getFilePath","filename","path","resolve","__dirname","removeTempFile","filepath","fs","unlink","error","describe","test","done","lockFile","expect","toBeNull","message","toMatch","unlockFile","readFile","data","options","parse","errorMessage","process","platform","toEqual","lock"],"sources":["../../src/__tests__/lock.spec.ts"],"sourcesContent":["import path from 'path';\nimport fs from 'fs';\n\nimport { lockFile, unlockFile, readFile } from '../index';\n\ninterface Error {\n  message: string;\n}\n\nconst getFilePath = (filename: string): string => {\n  return path.resolve(__dirname, `assets/${filename}`);\n};\n\nconst removeTempFile = (filename: string): void => {\n  const filepath = getFilePath(filename);\n  fs.unlink(filepath, error => {\n    if (error) {\n      throw error;\n    }\n  });\n};\n\ndescribe('testing locking', () => {\n  describe('lockFile', () => {\n    test('file should be found to be locked', done => {\n      lockFile(getFilePath('package.json'), (error: Error) => {\n        expect(error).toBeNull();\n        removeTempFile('package.json.lock');\n        done();\n      });\n    });\n\n    test('file should fail to be found to be locked', done => {\n      lockFile(getFilePath('package.fail.json'), (error: Error) => {\n        expect(error.message).toMatch(/ENOENT: no such file or directory, stat '(.*)package.fail.json'/);\n        done();\n      });\n    });\n  });\n\n  describe('unlockFile', () => {\n    test('file should to be found to be unLock', done => {\n      unlockFile(getFilePath('package.json.lock'), (error: Error) => {\n        expect(error).toBeNull();\n        done();\n      });\n    });\n  });\n\n  describe('readFile', () => {\n    test('read file with no options should to be found to be read it as string', done => {\n      readFile(getFilePath('package.json'), {}, (error: Error, data: string) => {\n        expect(error).toBeNull();\n        done();\n      });\n    });\n\n    test('read file with no options should to be found to be read it as object', done => {\n      const options = {\n        parse: true,\n      };\n      readFile(getFilePath('package.json'), options, (error: Error, data: string) => {\n        expect(error).toBeNull();\n        done();\n      });\n    });\n\n    test('read file with options (parse) should to be not found to be read it', done => {\n      const options = {\n        parse: true,\n      };\n      readFile(getFilePath('package.fail.json'), options, (error: Error) => {\n        expect(error.message).toMatch(/ENOENT: no such file or directory, open '(.*)package.fail.json'/);\n        done();\n      });\n    });\n\n    test('read file with options should to be found to be read it and fails to be parsed', done => {\n      const options = {\n        parse: true,\n      };\n      const errorMessage =\n        process.platform === 'win32'\n          ? 'Unexpected token } in JSON at position 47'\n          : 'Unexpected token } in JSON at position 44';\n      readFile(getFilePath('wrong.package.json'), options, (error: Error) => {\n        expect(error.message).toEqual(errorMessage);\n        done();\n      });\n    });\n\n    test('read file with  options (parse, lock) should to be found to be read it as object', done => {\n      const options = {\n        parse: true,\n        lock: true,\n      };\n      readFile(getFilePath('package2.json'), options, (error: Error, data: string) => {\n        expect(error).toBeNull();\n        removeTempFile('package2.json.lock');\n        done();\n      });\n    });\n\n    test('read file with options (parse, lock) should to be found to be read it and fails to be parsed', done => {\n      const options = {\n        parse: true,\n        lock: true,\n      };\n      const errorMessage =\n        process.platform === 'win32'\n          ? 'Unexpected token } in JSON at position 47'\n          : 'Unexpected token } in JSON at position 44';\n      readFile(getFilePath('wrong.package.json'), options, (error: Error) => {\n        expect(error.message).toEqual(errorMessage);\n        removeTempFile('wrong.package.json.lock');\n        done();\n      });\n    });\n  });\n});\n"],"mappings":"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"}