{"version":3,"file":"getLocalRegistryTarballUri.js","names":["debug","buildDebug","extractTarballFromUrl","url","URL","parse","pathname","replace","getLocalRegistryTarballUri","uri","pkgName","requestOptions","urlPrefix","currentHost","headers","host","tarballName","domainRegistry","getPublicUrl"],"sources":["../src/getLocalRegistryTarballUri.ts"],"sourcesContent":["import buildDebug from 'debug';\nimport URL from 'url';\n\nimport { RequestOptions } from '@verdaccio/url';\nimport { getPublicUrl } from '@verdaccio/url';\n\nconst debug = buildDebug('verdaccio:core:url');\n\nexport function extractTarballFromUrl(url: string): string {\n  // @ts-ignore\n  return URL.parse(url).pathname.replace(/^.*\\//, '');\n}\n/**\n * Filter a tarball url.\n * @param {*} uri\n * @return {String} a parsed url\n */\nexport function getLocalRegistryTarballUri(\n  uri: string,\n  pkgName: string,\n  requestOptions: RequestOptions,\n  urlPrefix: string | void\n): string {\n  const currentHost = requestOptions?.headers?.host;\n\n  if (!currentHost) {\n    return uri;\n  }\n  const tarballName = extractTarballFromUrl(uri);\n  debug('tarball name %o', tarballName);\n  // header only set with proxy that setup with HTTPS\n  const domainRegistry = getPublicUrl(urlPrefix || '', requestOptions);\n\n  return `${domainRegistry}${pkgName}/-/${tarballName}`;\n}\n"],"mappings":";;;;;;;AAAA;AACA;AAGA;AAA8C;AAE9C,MAAMA,KAAK,GAAG,IAAAC,cAAU,EAAC,oBAAoB,CAAC;AAEvC,SAASC,qBAAqB,CAACC,GAAW,EAAU;EACzD;EACA,OAAOC,YAAG,CAACC,KAAK,CAACF,GAAG,CAAC,CAACG,QAAQ,CAACC,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC;AACrD;AACA;AACA;AACA;AACA;AACA;AACO,SAASC,0BAA0B,CACxCC,GAAW,EACXC,OAAe,EACfC,cAA8B,EAC9BC,SAAwB,EAChB;EAAA;EACR,MAAMC,WAAW,GAAGF,cAAc,aAAdA,cAAc,gDAAdA,cAAc,CAAEG,OAAO,0DAAvB,sBAAyBC,IAAI;EAEjD,IAAI,CAACF,WAAW,EAAE;IAChB,OAAOJ,GAAG;EACZ;EACA,MAAMO,WAAW,GAAGd,qBAAqB,CAACO,GAAG,CAAC;EAC9CT,KAAK,CAAC,iBAAiB,EAAEgB,WAAW,CAAC;EACrC;EACA,MAAMC,cAAc,GAAG,IAAAC,kBAAY,EAACN,SAAS,IAAI,EAAE,EAAED,cAAc,CAAC;EAEpE,OAAQ,GAAEM,cAAe,GAAEP,OAAQ,MAAKM,WAAY,EAAC;AACvD"}