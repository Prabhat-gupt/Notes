{"version":3,"file":"convertDistRemoteToLocalTarballUrls.js","names":["convertDistRemoteToLocalTarballUrls","pkg","request","urlPrefix","name","versions","convertedPkg","convertedVersions","ver","Object","prototype","hasOwnProperty","call","version","convertDistVersionToLocalTarballsUrl","distName","dist","_","isNull","tarball","getLocalRegistryTarballUri"],"sources":["../src/convertDistRemoteToLocalTarballUrls.ts"],"sourcesContent":["import _ from 'lodash';\n\nimport { Package, Version } from '@verdaccio/types';\nimport { RequestOptions } from '@verdaccio/url';\n\nimport { getLocalRegistryTarballUri } from './getLocalRegistryTarballUri';\n\n/**\n * Iterate a packages's versions and filter each original tarball url.\n * @param {*} pkg\n * @param {*} req\n * @param {*} config\n * @return {String} a filtered package\n */\nexport function convertDistRemoteToLocalTarballUrls(\n  pkg: Package,\n  request: RequestOptions,\n  urlPrefix: string | void\n): Package {\n  const { name, versions } = pkg;\n  const convertedPkg = { ...pkg };\n  const convertedVersions = versions;\n  for (const ver in pkg.versions) {\n    if (Object.prototype.hasOwnProperty.call(pkg.versions, ver)) {\n      const version = versions[ver];\n      convertedVersions[ver] = convertDistVersionToLocalTarballsUrl(\n        name,\n        version,\n        request,\n        urlPrefix\n      );\n    }\n  }\n\n  return {\n    ...convertedPkg,\n    versions: convertedVersions,\n  };\n}\n\n/**\n * Convert single Version disst tarball\n * @param name\n * @param version\n * @param request\n * @param urlPrefix\n * @returns\n */\nexport function convertDistVersionToLocalTarballsUrl(name, version: Version, request, urlPrefix) {\n  const distName = version.dist;\n\n  if (_.isNull(distName) === false && _.isNull(distName.tarball) === false) {\n    return {\n      ...version,\n      dist: {\n        ...distName,\n        tarball: getLocalRegistryTarballUri(distName.tarball, name, request, urlPrefix),\n      },\n    };\n  }\n\n  return version;\n}\n"],"mappings":";;;;;;;AAAA;AAKA;AAA0E;AAE1E;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,mCAAmC,CACjDC,GAAY,EACZC,OAAuB,EACvBC,SAAwB,EACf;EACT,MAAM;IAAEC,IAAI;IAAEC;EAAS,CAAC,GAAGJ,GAAG;EAC9B,MAAMK,YAAY,GAAG;IAAE,GAAGL;EAAI,CAAC;EAC/B,MAAMM,iBAAiB,GAAGF,QAAQ;EAClC,KAAK,MAAMG,GAAG,IAAIP,GAAG,CAACI,QAAQ,EAAE;IAC9B,IAAII,MAAM,CAACC,SAAS,CAACC,cAAc,CAACC,IAAI,CAACX,GAAG,CAACI,QAAQ,EAAEG,GAAG,CAAC,EAAE;MAC3D,MAAMK,OAAO,GAAGR,QAAQ,CAACG,GAAG,CAAC;MAC7BD,iBAAiB,CAACC,GAAG,CAAC,GAAGM,oCAAoC,CAC3DV,IAAI,EACJS,OAAO,EACPX,OAAO,EACPC,SAAS,CACV;IACH;EACF;EAEA,OAAO;IACL,GAAGG,YAAY;IACfD,QAAQ,EAAEE;EACZ,CAAC;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASO,oCAAoC,CAACV,IAAI,EAAES,OAAgB,EAAEX,OAAO,EAAEC,SAAS,EAAE;EAC/F,MAAMY,QAAQ,GAAGF,OAAO,CAACG,IAAI;EAE7B,IAAIC,eAAC,CAACC,MAAM,CAACH,QAAQ,CAAC,KAAK,KAAK,IAAIE,eAAC,CAACC,MAAM,CAACH,QAAQ,CAACI,OAAO,CAAC,KAAK,KAAK,EAAE;IACxE,OAAO;MACL,GAAGN,OAAO;MACVG,IAAI,EAAE;QACJ,GAAGD,QAAQ;QACXI,OAAO,EAAE,IAAAC,sDAA0B,EAACL,QAAQ,CAACI,OAAO,EAAEf,IAAI,EAAEF,OAAO,EAAEC,SAAS;MAChF;IACF,CAAC;EACH;EAEA,OAAOU,OAAO;AAChB"}